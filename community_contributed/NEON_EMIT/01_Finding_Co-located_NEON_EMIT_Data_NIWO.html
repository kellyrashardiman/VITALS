<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>1 Finding Co-located EMIT and NEON AOP Data – VITALS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2486e1f0a3ee9ee1fc393803a1361cdb.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-6561bbde787c299e21493071c8edc6ff.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-fdfdc58ad6c2f6f036eeed4db0fdae11.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">1. Setup</a>
  <ul class="collapse">
  <li><a href="#neon-data-api-and-python-functions" id="toc-neon-data-api-and-python-functions" class="nav-link" data-scroll-target="#neon-data-api-and-python-functions">1.2 NEON Data API and Python Functions</a></li>
  <li><a href="#nasa-earthdata-login-credentials" id="toc-nasa-earthdata-login-credentials" class="nav-link" data-scroll-target="#nasa-earthdata-login-credentials">1.3 NASA Earthdata Login Credentials</a></li>
  </ul></li>
  <li><a href="#search-for-neon-and-emit-data" id="toc-search-for-neon-and-emit-data" class="nav-link" data-scroll-target="#search-for-neon-and-emit-data">2. Search for NEON and EMIT Data</a>
  <ul class="collapse">
  <li><a href="#define-spatial-regions-of-interest-rois" id="toc-define-spatial-regions-of-interest-rois" class="nav-link" data-scroll-target="#define-spatial-regions-of-interest-rois">2.1 Define Spatial Regions of Interest (ROIs)</a></li>
  <li><a href="#define-emit-collections-of-interest" id="toc-define-emit-collections-of-interest" class="nav-link" data-scroll-target="#define-emit-collections-of-interest">2.2 Define EMIT Collections of Interest</a></li>
  <li><a href="#define-date-range" id="toc-define-date-range" class="nav-link" data-scroll-target="#define-date-range">2.3 Define Date Range</a></li>
  <li><a href="#searching" id="toc-searching" class="nav-link" data-scroll-target="#searching">2.4 Searching</a></li>
  </ul></li>
  <li><a href="#organizing-and-filtering-results" id="toc-organizing-and-filtering-results" class="nav-link" data-scroll-target="#organizing-and-filtering-results">3. Organizing and Filtering Results</a></li>
  <li><a href="#visualizing-intersecting-coverage" id="toc-visualizing-intersecting-coverage" class="nav-link" data-scroll-target="#visualizing-intersecting-coverage">4. Visualizing Intersecting Coverage</a>
  <ul class="collapse">
  <li><a href="#previewing-emit-browse-imagery" id="toc-previewing-emit-browse-imagery" class="nav-link" data-scroll-target="#previewing-emit-browse-imagery">4.2 Previewing EMIT Browse Imagery</a></li>
  <li><a href="#further-filtering" id="toc-further-filtering" class="nav-link" data-scroll-target="#further-filtering">4.3 Further Filtering</a></li>
  </ul></li>
  <li><a href="#generating-a-list-of-urls-and-downloading-data" id="toc-generating-a-list-of-urls-and-downloading-data" class="nav-link" data-scroll-target="#generating-a-list-of-urls-and-downloading-data">5. Generating a list of URLs and downloading data</a></li>
  <li><a href="#contact-info" id="toc-contact-info" class="nav-link" data-scroll-target="#contact-info">Contact Info:</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">1 Finding Co-located EMIT and NEON AOP Data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Summary</strong></p>
<p>The Earth surface Mineral dust source InvesTigation (EMIT) instrument is located on the International Space Station (ISS) and has collected data over a large area of the Continental US. The National Ecological Observatory Network (NEON) Airborne Observation Platform (AOP) collects aerial remote sensing data, including hyperspectral reflectance data over sites across the United States and Puerto Rico. In this notebook we will show how to utilize the <a href="https://github.com/nsidc/earthaccess"><code>earthaccess</code> Python library</a> to find spatially overlapping EMIT and NEON reflectance data at NEON’s <a href="https://www.neonscience.org/field-sites/niwo">Niwot Ridge</a> site (NIWO) in the Rocky Mountains of Colorado.</p>
<div>
<p><img src="./neon_notebook_figs/NEON_NIWO_EMIT_Co-located_Data.PNG" width="750"></p>
</div>
<p><strong>Background</strong></p>
<p>The <strong>EMIT</strong> instrument is an imaging spectrometer that measures light in visible (V) to short-wave (SWIR) infrared wavelengths; this is also referred to as a VSWIR sensor. These measurements display unique spectral signatures that correspond to the composition on the Earth’s surface. The EMIT mission focuses specifically on mapping the composition of minerals to better understand the effects of mineral dust throughout the Earth system and human populations now and in the future. In addition, the EMIT instrument can be used in other applications, such as mapping of greenhouse gases, snow properties, and water resources.</p>
<p>More details about EMIT and its associated products can be found on the <a href="https://earth.jpl.nasa.gov/emit/">EMIT website</a> and <a href="https://lpdaac.usgs.gov/product_search/?query=EMIT&amp;status=Operational&amp;view=cards&amp;sort=title">EMIT product pages</a> hosted by the LP DAAC.</p>
<p>The <strong>NEON Imaging Spectrometer (NIS)</strong> is an airborne <a href="https://www.neonscience.org/data-collection/imaging-spectrometer">imaging spectrometer</a> built by JPL (AVIRIS-NG) and operated by the National Ecological Observatory Network’s (NEON) Airborne Observation Platform (AOP). NEON’s hyperspectral sensors collect measurements of sunlight reflected from the Earth’s surface in 426 narrow (~5 nm) spectral channels spanning wavelengths between ~ 380 - 2500 nm. NEON’s remote sensing data is intended to map and answer questions about a landscape, with ecological applications including identifying and classifying plant species and communities, mapping vegetation health, detecting disease or invasive species, and mapping droughts, wildfires, or other natural disturbances and their impacts.</p>
<p>NEON surveys sites spanning the continental US, during peak phenological greenness, capturing each site 3 out of every 5 years, for most terrestrial sites. AOP’s <a href="https://www.neonscience.org/data-collection/flight-schedules-coverage">Flight Schedules and Coverage</a> provide’s more information about the current and past schedules.</p>
<p>More detailed information about NEON’s airborne sampling design can be found in the paper: <a href="https://besjournals.onlinelibrary.wiley.com/doi/10.1111/2041-210X.13942">Spanning scales: The airborne spatial and temporal sampling design of the National Ecological Observatory Network</a>.</p>
<p><strong>Requirements</strong><br>
- <a href="https://urs.earthdata.nasa.gov/home">NASA Earthdata Account</a><br>
- <em>No Python setup requirements if connected to the workshop cloud instance!</em><br>
- <strong>Local Only</strong> Set up Python Environment - See <strong>setup_instructions.md</strong> in the <code>/setup/</code> folder to set up a local compatible Python environment</p>
<ul>
<li>NEON API Token (optional, but recommended), see <a href="https://www.neonscience.org/resources/learning-hub/tutorials/neon-api-tokens-tutorial">NEON API Tokens Tutorial</a></li>
</ul>
<p><strong>Download the NEON Flight Boundary Shapefile:</strong> <a href="https://www.neonscience.org/sites/default/files/AOP_flightBoxes_0.zip" class="link--button link--arrow">AOP_flightBoxes.zip</a></p>
<p><strong>Learning Objectives</strong><br>
- Use functions provided in an external Python module to find and download available NEON airborne reflectance data. - Use <code>earthaccess</code> to find EMIT data that overlaps with a NEON site. - How to export a list of files and download them programmatically.</p>
<p><strong>Tutorial Outline</strong></p>
<ol type="1">
<li>Setup</li>
<li>Explore NEON sites and finding available NEON reflectance data</li>
<li>Search for EMIT reflectance data<br>
</li>
<li>Organize and filter results</li>
<li>Visualize intersecting NEON-EMIT coverage</li>
<li>Create a list of EMIT asset URLs</li>
<li>Download EMIT data</li>
</ol>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">1. Setup</h2>
<p>Import the required Python libraries.</p>
<div id="cell-3" class="cell" data-tags="[]" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import required libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os, sys</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> earthaccess</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium.plugins</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> zipfile <span class="im">import</span> ZipFile</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> branca.element <span class="im">import</span> Figure</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely <span class="im">import</span> geometry</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> skimage <span class="im">import</span> io</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> timedelta</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry.polygon <span class="im">import</span> orient</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="neon-data-api-and-python-functions" class="level3">
<h3 class="anchored" data-anchor-id="neon-data-api-and-python-functions">1.2 NEON Data API and Python Functions</h3>
<p>Note: In Sept-Oct 2024, these next two chunks of code can be replaced with the Python neonUtilities package, which has built in functions for downloading NEON AOP data.</p>
<div id="cell-5" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to download data stored on the internet in a public url to a local file</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download_url(url,download_dir):</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.isdir(download_dir):</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        os.makedirs(download_dir)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> url.split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> requests.get(url, allow_redirects<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    file_object <span class="op">=</span> <span class="bu">open</span>(os.path.join(download_dir,filename),<span class="st">'wb'</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    file_object.write(r.content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-6" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>neon_code_folder <span class="op">=</span> <span class="st">'./neon_python_modules'</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>aop_download_module_url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/NEONScience/NEON-Data-Skills/main/tutorials/Python/AOP/aop_python_modules/neon_aop_download_functions.py"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>download_url(aop_download_module_url,neon_code_folder)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#os.listdir(neon_code_folder) #optionally show the contents of this directory to confirm the files downloaded</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># add the code folder to the path and import the neon aop download functions module</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>,neon_code_folder)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> neon_aop_download_functions <span class="im">as</span> aop_dl<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="nasa-earthdata-login-credentials" class="level3">
<h3 class="anchored" data-anchor-id="nasa-earthdata-login-credentials">1.3 NASA Earthdata Login Credentials</h3>
<p>To download or stream NASA data you will need an Earthdata account, you can create one <a href="https://urs.earthdata.nasa.gov/home">here</a>. We will use the <code>login</code> function from the <code>earthaccess</code> library for authentication before downloading at the end of the notebook. This function can also be used to create a local <code>.netrc</code> file if it doesn’t exist or add your login info to an existing <code>.netrc</code> file. If no Earthdata Login credentials are found in the <code>.netrc</code> you’ll be prompted for them. This step is not necessary to conduct searches but is needed to download or stream data.</p>
</section>
</section>
<section id="search-for-neon-and-emit-data" class="level2">
<h2 class="anchored" data-anchor-id="search-for-neon-and-emit-data">2. Search for NEON and EMIT Data</h2>
<p>NEON data products are hosted on the NEON Data Portal, and can be accessed via an API. We will import a Python module including some functions that interact with the NEON data API to easily see what data are available (in what years), and download data.</p>
<p>The EMIT products are hosted by the Land Processes Distributed Active Archive Center (LP DAAC). In this example we will use the cloud-hosted EMIT_L2A_RFL and ECOSTRESS_L2T_LSTE products available from the LP DAAC to find data. Any results we find for these products, should be available for other products within the EMIT and ECOSTRESS collections.</p>
<p>To find data we will use the <a href="https://github.com/nsidc/earthaccess"><code>earthaccess</code> Python library</a>. <code>earthaccess</code> searches NASA’s Common Metadata Repository (CMR), a metadata system that catalogs Earth Science data and associated metadata records. The results can then be used to download granules or generate lists of granule search result URLs.</p>
<p>Using <code>earthaccess</code> we can search based on the attributes of a granule, which can be thought of as a spatiotemporal scene from an instrument containing multiple assets (ex: Reflectance, Reflectance Uncertainty, Masks for the EMIT L2A Reflectance Collection). We can search using attributes such as collection, acquisition time, and spatial footprint. This process can also be used with other EMIT or ECOSTRESS products, other collections, or different data providers, as well as across multiple catalogs with some modification.</p>
<section id="define-spatial-regions-of-interest-rois" class="level3">
<h3 class="anchored" data-anchor-id="define-spatial-regions-of-interest-rois">2.1 Define Spatial Regions of Interest (ROIs)</h3>
<p>For this example, our spatial region of interest (ROI) will be the NEON site <a href="https://www.neonscience.org/field-sites/niwo">Niwot Ridge (NIWO)</a> in the Rocky Mountains, Colorado.</p>
<p>In this example, we will create a rectangular ROI surrounding the NIWO flight box. We will search for co-located EMIT data using a polygon rather than a standard bounding box in <code>earthaccess</code>. To search for intersections with a polygon using earthaccess, we need to format our ROI as a counterclockwise list of coordinate pairs.</p>
<p>Download, Unzip, and Open the shape file (.shp) containing the AOP flight box boundaries, which can be downloaded from <a href="https://www.neonscience.org/data-samples/data/spatial-data-maps">NEON Spatial Data and Maps</a>. Read this into a <code>geodataframe</code>, explore the contents, and check the coordinate reference system (CRS) of the data.</p>
<div id="cell-9" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download and Unzip the NEON Flight Boundary Shapefile</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>neon_boundary_url <span class="op">=</span> <span class="st">"https://www.neonscience.org/sites/default/files/AOP_flightBoxes_0.zip"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Use download_url function to save the file to a directory</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>os.makedirs(<span class="st">'./data'</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>download_url(neon_boundary_url,<span class="st">'./data'</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Unzip the file</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> ZipFile(<span class="ss">f"./data/</span><span class="sc">{</span>neon_boundary_url<span class="sc">.</span>split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>, <span class="st">'r'</span>) <span class="im">as</span> zip_ref:</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    zip_ref.extractall(<span class="st">'./data'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-10" class="cell" data-scrolled="true" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>aop_flightboxes <span class="op">=</span> gpd.read_file(<span class="st">"./data/AOP_flightBoxes/AOP_flightboxesAllSites.shp"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>aop_flightboxes.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">domain</th>
<th data-quarto-table-cell-role="th">domainName</th>
<th data-quarto-table-cell-role="th">siteName</th>
<th data-quarto-table-cell-role="th">siteID</th>
<th data-quarto-table-cell-role="th">siteType</th>
<th data-quarto-table-cell-role="th">sampleType</th>
<th data-quarto-table-cell-role="th">priority</th>
<th data-quarto-table-cell-role="th">version</th>
<th data-quarto-table-cell-role="th">flightbxID</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>D01</td>
<td>Northeast</td>
<td>Bartlett Experimental Forest NEON</td>
<td>BART</td>
<td>Gradient</td>
<td>Terrestrial</td>
<td>1</td>
<td>1</td>
<td>D01_BART_R1_P1_v1</td>
<td>POLYGON ((-71.33426 43.99197, -71.33423 44.081...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>D01</td>
<td>Northeast</td>
<td>Harvard Forest &amp; Quabbin Watershed NEON</td>
<td>HARV</td>
<td>Core</td>
<td>Terrestrial</td>
<td>1</td>
<td>1</td>
<td>D01_HARV_C1_P1_v1</td>
<td>POLYGON ((-72.14819 42.57510, -72.14776 42.383...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>D01</td>
<td>Northeast</td>
<td>Harvard Forest &amp; Quabbin Watershed NEON</td>
<td>HARV</td>
<td>Core</td>
<td>Terrestrial</td>
<td>3</td>
<td>1</td>
<td>D01_HARV_C1_P3_v1</td>
<td>POLYGON ((-72.10812 42.43653, -72.14788 42.436...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>D01</td>
<td>Northeast</td>
<td>Lower Hop Brook NEON</td>
<td>HOPB</td>
<td>Core</td>
<td>Aquatic</td>
<td>2</td>
<td>1</td>
<td>D01_HOPB_C1_P2_v1</td>
<td>POLYGON ((-72.36635 42.46399, -72.36635 42.514...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>D19</td>
<td>Taiga</td>
<td>Healy NEON</td>
<td>HEAL</td>
<td>Gradient</td>
<td>Terrestrial</td>
<td>1</td>
<td>1</td>
<td>D19_HEAL_R3_P1_v1</td>
<td>POLYGON ((-149.31505 63.82981, -149.31505 63.9...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-11" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>aop_flightboxes.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>&lt;Geographic 2D CRS: EPSG:4326&gt;
Name: WGS 84
Axis Info [ellipsoidal]:
- Lat[north]: Geodetic latitude (degree)
- Lon[east]: Geodetic longitude (degree)
Area of Use:
- name: World.
- bounds: (-180.0, -90.0, 180.0, 90.0)
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<p>The CRS is <strong>EPSG:4326</strong> (WGS84), which is also the CRS we want the data in to submit for our search of EMIT data.</p>
<p>Next, let’s examine the AOP flightboxes polygons further. For this exercise, we’ll first look at Niwot Ridge site in Colorado.</p>
<div id="cell-13" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>aop_flightboxes[aop_flightboxes.siteID <span class="op">==</span> <span class="st">'NIWO'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">domain</th>
<th data-quarto-table-cell-role="th">domainName</th>
<th data-quarto-table-cell-role="th">siteName</th>
<th data-quarto-table-cell-role="th">siteID</th>
<th data-quarto-table-cell-role="th">siteType</th>
<th data-quarto-table-cell-role="th">sampleType</th>
<th data-quarto-table-cell-role="th">priority</th>
<th data-quarto-table-cell-role="th">version</th>
<th data-quarto-table-cell-role="th">flightbxID</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">49</td>
<td>D13</td>
<td>Southern Rockies &amp; Colorado Plateau</td>
<td>Niwot Ridge NEON</td>
<td>NIWO</td>
<td>Core</td>
<td>Terrestrial</td>
<td>1</td>
<td>2</td>
<td>D13_NIWO_C1_P1_v2</td>
<td>POLYGON ((-105.48908 40.07292, -105.48912 39.9...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can see the NIWO <code>geodataframe</code> consists of a single polygon, that we want to include in our study site (sometimes NEON sites may have more than one polygon, as there are sometimes multiple areas, with different priorities for collection).</p>
<div id="cell-15" class="cell" data-tags="[]" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write this to a new variable called "niwo_polygon"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>niwo_polygon <span class="op">=</span> aop_flightboxes[aop_flightboxes.siteID <span class="op">==</span> <span class="st">'NIWO'</span>]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># subset to only include columns of interest</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>niwo_polygon <span class="op">=</span> niwo_polygon[[<span class="st">'domain'</span>,<span class="st">'siteName'</span>,<span class="st">'siteID'</span>,<span class="st">'sampleType'</span>,<span class="st">'flightbxID'</span>,<span class="st">'priority'</span>,<span class="st">'geometry'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-16" class="cell" data-tags="[]" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create external boundary of the shape</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>niwo_roi_poly <span class="op">=</span> niwo_polygon.unary_union.envelope</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-order vertices to counterclockwise</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>niwo_roi_poly <span class="op">=</span> orient(niwo_roi_poly, sign<span class="op">=</span><span class="fl">1.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make a <code>GeoDataFrame</code> consisting of the bounding box geometry.</p>
<div id="cell-18" class="cell" data-tags="[]" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>niwo_df <span class="op">=</span> pd.DataFrame({<span class="st">"Name"</span>:[<span class="st">"NIWO ROI Bounding Box"</span>]})</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>niwo_bbox <span class="op">=</span> gpd.GeoDataFrame({<span class="st">"Name"</span>:[<span class="st">"NIWO ROI Bounding Box"</span>], <span class="st">"geometry"</span>:[niwo_roi_poly]},crs<span class="op">=</span><span class="st">"EPSG:4326"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>niwo_bbox</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NIWO ROI Bounding Box</td>
<td>POLYGON ((-105.64789 39.98286, -105.48908 39.9...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can write this bounding box to a <code>geojson</code> file for use in future notebooks. This is commented out for now, but you can uncomment and run the cell below, if desired.</p>
<div id="cell-20" class="cell" data-tags="[]" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#niwo_bbox.to_file('../data/niwo_bbox.geojson', driver='GeoJSON')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we can visualize our region of interest and the exterior boundary polygon containing ROIs. First add a function to help reformat bounding box coordinates to work with leaflet notation.</p>
<div id="cell-22" class="cell" data-tags="[]" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to convert a bounding box for use in leaflet notation</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_bounds(bbox, invert_y<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Helper method for changing bounding box representation to leaflet notation</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ``(lon1, lat1, lon2, lat2) -&gt; ((lat1, lon1), (lat2, lon2))``</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    x1, y1, x2, y2 <span class="op">=</span> bbox</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> invert_y:</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        y1, y2 <span class="op">=</span> y2, y1</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ((y1, x1), (y2, x2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-23" class="cell" data-tags="[]" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> Figure(width<span class="op">=</span><span class="st">"750px"</span>, height<span class="op">=</span><span class="st">"375px"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>map1 <span class="op">=</span> folium.Map(tiles<span class="op">=</span><span class="st">'https://mt1.google.com/vt/lyrs=y&amp;x=</span><span class="sc">{x}</span><span class="st">&amp;y=</span><span class="sc">{y}</span><span class="st">&amp;z=</span><span class="sc">{z}</span><span class="st">'</span>, attr<span class="op">=</span><span class="st">'Google'</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>fig.add_child(map1)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add NIWO Bounding Box</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>folium.GeoJson(niwo_bbox, name<span class="op">=</span><span class="st">'bounding_box'</span>).add_to(map1)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Add roi geodataframe</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>niwo_polygon.explore(<span class="st">"flightbxID"</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>                     popup<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>                     categorical<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                     cmap<span class="op">=</span><span class="st">'Set3'</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>                     style_kwds<span class="op">=</span><span class="bu">dict</span>(opacity<span class="op">=</span><span class="fl">0.7</span>, fillOpacity<span class="op">=</span><span class="fl">0.4</span>),</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>                     name<span class="op">=</span><span class="st">"Niwot Ridge ROI"</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>                     m<span class="op">=</span>map1)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>map1.add_child(folium.LayerControl())</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>map1.fit_bounds(bounds<span class="op">=</span>convert_bounds(niwo_polygon.unary_union.bounds))</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>display(fig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<iframe srcdoc="<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; />
    
        <script>
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        </script>
    
    <style>html, body {width: 100%;height: 100%;margin: 0;padding: 0;}</style>
    <style>#map {position:absolute;top:0;bottom:0;right:0;left:0;}</style>
    <script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;></script>
    <script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;></script>
    <script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;></script>
    <script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/>
    
            <meta name=&quot;viewport&quot; content=&quot;width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; />
            <style>
                #map_a98847f8b8ba1d544d61e74b580d738e {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>
        
    
                    <style>
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    </style>
            
    
                    <style>
                        .foliumpopup {
                            margin: auto;
                        }
                       .foliumpopup table{
                            margin: auto;
                        }
                        .foliumpopup tr{
                            text-align: left;
                        }
                        .foliumpopup th{
                            padding: 2px; padding-right: 8px;
                        }
                    </style>
            
    
    <script src=&quot;https://code.jquery.com/ui/1.12.1/jquery-ui.js&quot;></script>
    <script>$( function() {
        $( &quot;.maplegend&quot; ).draggable({
            start: function (event, ui) {
                $(this).css({
                    right: &quot;auto&quot;,
                    top: &quot;auto&quot;,
                    bottom: &quot;auto&quot;
                });
            }
        });
    });
    </script>
    <style type='text/css'>
      .maplegend {
        position: absolute;
        z-index:9999;
        background-color: rgba(255, 255, 255, .8);
        border-radius: 5px;
        box-shadow: 0 0 15px rgba(0,0,0,0.2);
        padding: 10px;
        font: 12px/14px Arial, Helvetica, sans-serif;
        right: 10px;
        bottom: 20px;
      }
      .maplegend .legend-title {
        text-align: left;
        margin-bottom: 5px;
        font-weight: bold;
        }
      .maplegend .legend-scale ul {
        margin: 0;
        margin-bottom: 0px;
        padding: 0;
        float: left;
        list-style: none;
        }
      .maplegend .legend-scale ul li {
        list-style: none;
        margin-left: 0;
        line-height: 16px;
        margin-bottom: 2px;
        }
      .maplegend ul.legend-labels li span {
        display: block;
        float: left;
        height: 14px;
        width: 14px;
        margin-right: 5px;
        margin-left: 0;
        border: 0px solid #ccc;
        }
      .maplegend .legend-source {
        color: #777;
        clear: both;
        }
      .maplegend a {
        color: #777;
        }
    </style>
    
</head>
<body>
    
    
    <div id='maplegend flightbxID' class='maplegend'>
        <div class='legend-title'>flightbxID</div>
        <div class='legend-scale'>
            <ul class='legend-labels'>
                <li><span style='background:#8dd3c7'></span>D13_NIWO_C1_P1_v2</li>
            </ul>
        </div>
    </div>
    
    
            <div class=&quot;folium-map&quot; id=&quot;map_a98847f8b8ba1d544d61e74b580d738e&quot; ></div>
        
</body>
<script>
    
    
            var map_a98847f8b8ba1d544d61e74b580d738e = L.map(
                &quot;map_a98847f8b8ba1d544d61e74b580d738e&quot;,
                {
                    center: [0.0, 0.0],
                    crs: L.CRS.EPSG3857,
                    zoom: 1,
                    zoomControl: true,
                    preferCanvas: false,
                }
            );

            

        
    
            var tile_layer_57f25850cb55bfa836b437170780c9d4 = L.tileLayer(
                &quot;https://mt1.google.com/vt/lyrs=y\u0026x={x}\u0026y={y}\u0026z={z}&quot;,
                {&quot;attribution&quot;: &quot;Google&quot;, &quot;detectRetina&quot;: false, &quot;maxZoom&quot;: 18, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            tile_layer_57f25850cb55bfa836b437170780c9d4.addTo(map_a98847f8b8ba1d544d61e74b580d738e);
        
    

        function geo_json_f00f63b9d0edd8ba060b7196e97bb118_onEachFeature(feature, layer) {
            layer.on({
            });
        };
        var geo_json_f00f63b9d0edd8ba060b7196e97bb118 = L.geoJson(null, {
                onEachFeature: geo_json_f00f63b9d0edd8ba060b7196e97bb118_onEachFeature,
            
        });

        function geo_json_f00f63b9d0edd8ba060b7196e97bb118_add (data) {
            geo_json_f00f63b9d0edd8ba060b7196e97bb118
                .addData(data);
        }
            geo_json_f00f63b9d0edd8ba060b7196e97bb118_add({&quot;bbox&quot;: [-105.64788824641289, 39.98286247719818, -105.48907581013356, 40.07295974374222], &quot;features&quot;: [{&quot;bbox&quot;: [-105.64788824641289, 39.98286247719818, -105.48907581013356, 40.07295974374222], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.64788824641289, 39.98286247719818], [-105.48907581013356, 39.98286247719818], [-105.48907581013356, 40.07295974374222], [-105.64788824641289, 40.07295974374222], [-105.64788824641289, 39.98286247719818]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;Name&quot;: &quot;NIWO ROI Bounding Box&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});
        geo_json_f00f63b9d0edd8ba060b7196e97bb118.setStyle(function(feature) {return feature.properties.style;});

        
    
            geo_json_f00f63b9d0edd8ba060b7196e97bb118.addTo(map_a98847f8b8ba1d544d61e74b580d738e);
        
    
        function geo_json_c8b513768b7678cc7daea96a461e1aa6_styler(feature) {
            switch(feature.id) {
                default:
                    return {&quot;color&quot;: &quot;#8dd3c7&quot;, &quot;fillColor&quot;: &quot;#8dd3c7&quot;, &quot;fillOpacity&quot;: 0.4, &quot;opacity&quot;: 0.7, &quot;weight&quot;: 2};
            }
        }
        function geo_json_c8b513768b7678cc7daea96a461e1aa6_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_c8b513768b7678cc7daea96a461e1aa6_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_c8b513768b7678cc7daea96a461e1aa6_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_c8b513768b7678cc7daea96a461e1aa6_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                            geo_json_c8b513768b7678cc7daea96a461e1aa6.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_c8b513768b7678cc7daea96a461e1aa6_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_c8b513768b7678cc7daea96a461e1aa6 = L.geoJson(null, {
                onEachFeature: geo_json_c8b513768b7678cc7daea96a461e1aa6_onEachFeature,
            
                style: geo_json_c8b513768b7678cc7daea96a461e1aa6_styler,
                pointToLayer: geo_json_c8b513768b7678cc7daea96a461e1aa6_pointToLayer,
        });

        function geo_json_c8b513768b7678cc7daea96a461e1aa6_add (data) {
            geo_json_c8b513768b7678cc7daea96a461e1aa6
                .addData(data);
        }
            geo_json_c8b513768b7678cc7daea96a461e1aa6_add({&quot;bbox&quot;: [-105.64788824641289, 39.98286247719818, -105.48907581013356, 40.07295974374222], &quot;features&quot;: [{&quot;bbox&quot;: [-105.64788824641289, 39.98286247719818, -105.48907581013356, 40.07295974374222], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.48907581013356, 40.07292430748697], [-105.48912180001292, 39.98286247719818], [-105.60625278516312, 39.982897848701725], [-105.6062315654986, 40.02432297671561], [-105.64739520015559, 40.024100318177716], [-105.64788824641289, 40.07275939845272], [-105.60620665139112, 40.07295974374222], [-105.48907581013356, 40.07292430748697]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;49&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#8dd3c7&quot;, &quot;domain&quot;: &quot;D13&quot;, &quot;flightbxID&quot;: &quot;D13_NIWO_C1_P1_v2&quot;, &quot;priority&quot;: 1, &quot;sampleType&quot;: &quot;Terrestrial&quot;, &quot;siteID&quot;: &quot;NIWO&quot;, &quot;siteName&quot;: &quot;Niwot Ridge NEON&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_c8b513768b7678cc7daea96a461e1aa6.bindTooltip(
    function(layer){
    let div = L.DomUtil.create('div');
    
    let handleObject = feature=>typeof(feature)=='object' ? JSON.stringify(feature) : feature;
    let fields = [&quot;domain&quot;, &quot;siteName&quot;, &quot;siteID&quot;, &quot;sampleType&quot;, &quot;flightbxID&quot;, &quot;priority&quot;];
    let aliases = [&quot;domain&quot;, &quot;siteName&quot;, &quot;siteID&quot;, &quot;sampleType&quot;, &quot;flightbxID&quot;, &quot;priority&quot;];
    let table = '<table>' +
        String(
        fields.map(
        (v,i)=>
        `<tr>
            <th>${aliases[i]}</th>
            
            <td>${handleObject(layer.feature.properties[v])}</td>
        </tr>`).join(''))
    +'</table>';
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
    
    geo_json_c8b513768b7678cc7daea96a461e1aa6.bindPopup(
    function(layer){
    let div = L.DomUtil.create('div');
    
    let handleObject = feature=>typeof(feature)=='object' ? JSON.stringify(feature) : feature;
    let fields = [&quot;domain&quot;, &quot;siteName&quot;, &quot;siteID&quot;, &quot;sampleType&quot;, &quot;flightbxID&quot;, &quot;priority&quot;];
    let aliases = [&quot;domain&quot;, &quot;siteName&quot;, &quot;siteID&quot;, &quot;sampleType&quot;, &quot;flightbxID&quot;, &quot;priority&quot;];
    let table = '<table>' +
        String(
        fields.map(
        (v,i)=>
        `<tr>
            <th>${aliases[i].toLocaleString()}</th>
            
            <td>${handleObject(layer.feature.properties[v]).toLocaleString()}</td>
        </tr>`).join(''))
    +'</table>';
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumpopup&quot;});
                     
    
            geo_json_c8b513768b7678cc7daea96a461e1aa6.addTo(map_a98847f8b8ba1d544d61e74b580d738e);
        
    
            var layer_control_b5800045a3ded2e55c73e7b6fcea5120_layers = {
                base_layers : {
                    &quot;https://mt1.google.com/vt/lyrs=y\u0026x={x}\u0026y={y}\u0026z={z}&quot; : tile_layer_57f25850cb55bfa836b437170780c9d4,
                },
                overlays :  {
                    &quot;bounding_box&quot; : geo_json_f00f63b9d0edd8ba060b7196e97bb118,
                    &quot;Niwot Ridge ROI&quot; : geo_json_c8b513768b7678cc7daea96a461e1aa6,
                },
            };
            let layer_control_b5800045a3ded2e55c73e7b6fcea5120 = L.control.layers(
                layer_control_b5800045a3ded2e55c73e7b6fcea5120_layers.base_layers,
                layer_control_b5800045a3ded2e55c73e7b6fcea5120_layers.overlays,
                {&quot;autoZIndex&quot;: true, &quot;collapsed&quot;: true, &quot;position&quot;: &quot;topright&quot;}
            ).addTo(map_a98847f8b8ba1d544d61e74b580d738e);

        
    
            map_a98847f8b8ba1d544d61e74b580d738e.fitBounds(
                [[39.98286247719818, -105.64788824641289], [40.07295974374222, -105.48907581013356]],
                {}
            );
        
</script>
</html>" width="750px" height="375px" style="border:none !important;" "allowfullscreen"="" "webkitallowfullscreen"="" "mozallowfullscreen"=""></iframe>
</div>
</div>
<p>Above we can see the Niwot Ridge flightbox, and the exterior boundary polygon containing the full area.</p>
<p>Lastly, we need to convert our polygon to a list of coordinate pairs, to create our Region of Interest (ROI).</p>
<div id="cell-26" class="cell" data-tags="[]" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set ROI as list of exterior polygon vertices as coordinate pairs</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>niwo_roi <span class="op">=</span> <span class="bu">list</span>(niwo_roi_poly.exterior.coords)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>niwo_roi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>[(-105.64788824641289, 39.98286247719818),
 (-105.48907581013356, 39.98286247719818),
 (-105.48907581013356, 40.07295974374222),
 (-105.64788824641289, 40.07295974374222),
 (-105.64788824641289, 39.98286247719818)]</code></pre>
</div>
</div>
<p>Finally we can look at the available NEON hyperspectral reflectance data over NIWO. NEON hyperspectral reflectance data are currently available under two different revisions, as AOP is in the process of implementing a BRDF (Bidirectional Reflectance Distribution Function), but this has not been applied to the full archive of data yet. These data are available under two revisions of the data product ID DP3.30006 - DP3.30006.001 are the directional surface reflectance, and DP3.30006.002 are the bidirectional (BRDF- and topographic- corrected) surface reflectance. Let’s see what’s available for each of these data products.</p>
<div id="cell-28" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>refl_rev1_dpid <span class="op">=</span> <span class="st">'DP3.30006.001'</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>refl_rev2_dpid <span class="op">=</span> <span class="st">'DP3.30006.002'</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>site <span class="op">=</span> <span class="st">'NIWO'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-29" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Directional Reflectance Data Available at NEON Site NIWO'</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>aop_dl.list_available_urls(refl_rev1_dpid,site)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Directional Reflectance Data Available at NEON Site NIWO</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>['https://data.neonscience.org/api/v0/data/DP3.30006.001/NIWO/2017-09',
 'https://data.neonscience.org/api/v0/data/DP3.30006.001/NIWO/2018-08',
 'https://data.neonscience.org/api/v0/data/DP3.30006.001/NIWO/2019-08',
 'https://data.neonscience.org/api/v0/data/DP3.30006.001/NIWO/2020-08']</code></pre>
</div>
</div>
<div id="cell-30" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Bidirectional Reflectance Data Available at NEON Site NIWO'</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>aop_dl.list_available_urls(refl_rev2_dpid,site)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bidirectional Reflectance Data Available at NEON Site NIWO
WARNING: no urls found for product DP3.30006.002 at site NIWO</code></pre>
</div>
</div>
<p>The bidirectional data for the later visits of NIWO are not yet available. We’ll start by looking at the directional surface reflectance for NIWO in 2020.</p>
<div id="cell-32" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>year <span class="op">=</span> <span class="st">'2020'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can download the reflectance data using the function <code>aop_dl.download_aop_files</code>. You can change the download path if desired.</p>
<p>Before we download the data, let’s look at the spatial extent. AOP data are provided in UTM projection. We can do this by downloading shapefiles of the tile boundaries. These are available as metadata provided along with the reflectance data products. The full boundary of the site is a file called “merged_tiles.shp/.shx”. Let’s only download this shapefile so we can see the file extent, and determine the UTM coordinates of the tiles we wish to download.</p>
<div id="cell-34" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aop_dl.download_aop_files?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-35" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download the full-boundary shape files from the lidar data. These are delivered as metadata as part of one of the Lidar data products, so note that the data product id (DPID) is different</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>aop_dl.download_aop_files(<span class="st">'DP1.30003.001'</span>,site,year,<span class="st">'./data/neon_refl'</span>,match_string<span class="op">=</span><span class="st">'merged_tiles.shp'</span>,check_size<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>aop_dl.download_aop_files(<span class="st">'DP1.30003.001'</span>,site,year,<span class="st">'./data/neon_refl'</span>,match_string<span class="op">=</span><span class="st">'merged_tiles.shx'</span>,check_size<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Download size: 0.61 kB
downloading 2020_NIWO_4_merged_tiles.shp to ./data/neon_refl
Download size: 0.0 kB
downloading 2020_NIWO_4_merged_tiles.shx to ./data/neon_refl</code></pre>
</div>
</div>
<div id="cell-36" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># optionally display the contents in the data/neon_refl folder to make sure the files have downloaded</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>os.listdir(<span class="st">'./data/neon_refl'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>['2020_NIWO_4_merged_tiles.shp',
 '2020_NIWO_4_merged_tiles.shx',
 'NEON_D13_NIWO_DP3_454000_4431000_reflectance.h5']</code></pre>
</div>
</div>
<div id="cell-37" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>niwo_2020_gdf <span class="op">=</span> gpd.read_file(os.path.join(<span class="st">'./data/neon_refl'</span>,<span class="st">'2020_NIWO_4_merged_tiles.shp'</span>))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>niwo_2020_gdf.plot(alpha<span class="op">=</span><span class="fl">0.5</span>)<span class="op">;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.gca()<span class="op">;</span> ax.ticklabel_format(style<span class="op">=</span><span class="st">'plain'</span>) </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'AOP Coverage of '</span> <span class="op">+</span> site <span class="op">+</span> <span class="st">' in '</span> <span class="op">+</span> year)<span class="op">;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)<span class="op">;</span> <span class="co">#optionally rotate the xtick labels</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_Finding_Co-located_NEON_EMIT_Data_NIWO_files/figure-html/cell-23-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The reflectance data can be large in size, so for now, we’ll just download a single tile, which encompasses the CU Boulder Mountain Research Station at Niwot Ridge. We can do that with the <code>download_aop_files</code> function as follows. This time leave out the <code>check_size</code> input parameter, and that will default to True. This will prompt you to download after displaying the download size. This reflectance file is ~615 MB, so make sure you have enough space on your local disk before downloading.</p>
<div id="cell-39" class="cell" data-scrolled="true" data-execution_count="23">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download a reflectance hdf5 tile</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>aop_dl.download_aop_files(<span class="st">'DP3.30006.001'</span>,site,year,<span class="st">'./data/neon_refl'</span>,match_string<span class="op">=</span><span class="st">'454000_4431000_reflectance.h5'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Download size: 615.17 MB
downloading NEON_D13_NIWO_DP3_454000_4431000_reflectance.h5 to ./data/neon_refl</code></pre>
</div>
</div>
</section>
<section id="define-emit-collections-of-interest" class="level3">
<h3 class="anchored" data-anchor-id="define-emit-collections-of-interest">2.2 Define EMIT Collections of Interest</h3>
<p>We need to specify which products we want to search for. The best way to do this is using their concept-id. As mentioned above, we will conduct our search using the EMIT Level 2A Reflectance (EMITL2ARFL). We can do some quick collection queries using <code>earthaccess</code> to retrieve the concept-id for each dataset.</p>
<div id="cell-41" class="cell" data-tags="[]" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># EMIT Collection Query</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>emit_collection_query <span class="op">=</span> earthaccess.collection_query().keyword(<span class="st">'EMIT L2A Reflectance'</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>emit_collection_query.fields([<span class="st">'ShortName'</span>,<span class="st">'EntryTitle'</span>,<span class="st">'Version'</span>]).get()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>[{
   "meta": {
     "concept-id": "C2408750690-LPCLOUD",
     "granule-count": 97750,
     "provider-id": "LPCLOUD"
   },
   "umm": {
     "ShortName": "EMITL2ARFL",
     "EntryTitle": "EMIT L2A Estimated Surface Reflectance and Uncertainty and Masks 60 m V001",
     "Version": "001"
   }
 }]</code></pre>
</div>
</div>
<p>If your search returns multiple products, be sure to select the right concept-id For this example it will be the first one. We want to use the <code>LPCLOUD</code> ECOSTRESS Tiled Land Surface Temperature and Emissivity (concept-id: “C2076090826-LPCLOUD”). Create a list of these concept-ids for our data search.</p>
<div id="cell-43" class="cell" data-tags="[]" data-execution_count="25">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data Collections for our search</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>emit_concept_id <span class="op">=</span> [<span class="st">'C2408750690-LPCLOUD'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="define-date-range" class="level3">
<h3 class="anchored" data-anchor-id="define-date-range">2.3 Define Date Range</h3>
<p>For our date range, we’ll look at data collected between January 2022 and October 2023. The <code>date_range</code> can be specified as a pair of dates, start and end (up to, not including).</p>
<div id="cell-45" class="cell" data-tags="[]" data-execution_count="26">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Date Range</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>date_range <span class="op">=</span> (<span class="st">'2022-01-01'</span>,<span class="st">'2023-11-01'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="searching" class="level3">
<h3 class="anchored" data-anchor-id="searching">2.4 Searching</h3>
<p>Submit a query using <code>earthaccess</code>, usin the <code>niwo_roi</code> as the region of interest.</p>
<div id="cell-47" class="cell" data-tags="[]" data-execution_count="27">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>emit_query_results <span class="op">=</span> earthaccess.search_data(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    concept_id<span class="op">=</span>emit_concept_id,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    polygon<span class="op">=</span>niwo_roi,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    temporal<span class="op">=</span>date_range,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    count<span class="op">=</span><span class="dv">500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="organizing-and-filtering-results" class="level2">
<h2 class="anchored" data-anchor-id="organizing-and-filtering-results">3. Organizing and Filtering Results</h2>
<p>As we can see from above, the results object contains a list of objects with metadata and links. We can convert this to a more readable format, a dataframe. In addition, we can make it a geodataframe by taking the spatial metadata and creating a shapely polygon representing the spatial coverage, and further customize which information we want to use from other metadata fields.</p>
<p>First, we define some functions to help us create a shapely object for our geodataframe, and retrieve the specific browse image URLs that we want. By default, the browse image selected by <code>earthaccess</code> is the first one in the list, but the ECO_L2_LSTE has several browse images, and we want to make sure we retrieve the <code>png</code> file, which is a preview of the LSTE.</p>
<div id="cell-49" class="cell" data-tags="[]" data-execution_count="28">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create shapely polygon of spatial coverage</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_shapely_object(result:earthaccess.results.DataGranule):</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get Geometry Keys</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    geo <span class="op">=</span> result[<span class="st">'umm'</span>][<span class="st">'SpatialExtent'</span>][<span class="st">'HorizontalSpatialDomain'</span>][<span class="st">'Geometry'</span>]</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    keys <span class="op">=</span> geo.keys()</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'BoundingRectangles'</span> <span class="kw">in</span> keys:</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        bounding_rectangle <span class="op">=</span> geo[<span class="st">'BoundingRectangles'</span>][<span class="dv">0</span>]</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create bbox tuple</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>        bbox_coords <span class="op">=</span> (bounding_rectangle[<span class="st">'WestBoundingCoordinate'</span>],bounding_rectangle[<span class="st">'SouthBoundingCoordinate'</span>],</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>                    bounding_rectangle[<span class="st">'EastBoundingCoordinate'</span>],bounding_rectangle[<span class="st">'NorthBoundingCoordinate'</span>])</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create shapely geometry from bbox</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>        shape <span class="op">=</span> geometry.box(<span class="op">*</span>bbox_coords, ccw<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">'GPolygons'</span> <span class="kw">in</span> keys:</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>        points <span class="op">=</span> geo[<span class="st">'GPolygons'</span>][<span class="dv">0</span>][<span class="st">'Boundary'</span>][<span class="st">'Points'</span>]</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create shapely geometry from polygons</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>        shape <span class="op">=</span> geometry.Polygon([[p[<span class="st">'Longitude'</span>],p[<span class="st">'Latitude'</span>]] <span class="cf">for</span> p <span class="kw">in</span> points])</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>         <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'Provided result does not contain bounding boxes/polygons or is incompatible.'</span>)</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(shape)</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve png browse image if it exists or first jpg in list of urls</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_png(result:earthaccess.results.DataGranule):</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    https_links <span class="op">=</span> [link <span class="cf">for</span> link <span class="kw">in</span> result.dataviz_links() <span class="cf">if</span> <span class="st">'https'</span> <span class="kw">in</span> link]</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(https_links) <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>        browse <span class="op">=</span> https_links[<span class="dv">0</span>]</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">len</span>(https_links) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>        browse <span class="op">=</span> <span class="st">'no browse image'</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>        warnings.warn(<span class="ss">f"There is no browse imagery for </span><span class="sc">{</span>result[<span class="st">'umm'</span>][<span class="st">'GranuleUR'</span>]<span class="sc">}</span><span class="ss">."</span>)</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>        browse <span class="op">=</span> [png <span class="cf">for</span> png <span class="kw">in</span> https_links <span class="cf">if</span> <span class="st">'.png'</span> <span class="kw">in</span> png][<span class="dv">0</span>]</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(browse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have our functions we can create a dataframe, then calculate and add our shapely geometries to make a geodataframe. After that, add a column for our browse image urls and print the number of granules in our results, so we can monitor the quantity we are working with a we winnow down to the data we want.</p>
<div id="cell-51" class="cell" data-tags="[]" data-execution_count="29">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Dataframe of Results Metadata</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>emit_results_df <span class="op">=</span> pd.json_normalize(emit_query_results)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create shapely polygons for result</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>geometries <span class="op">=</span> [get_shapely_object(emit_query_results[index]) <span class="cf">for</span> index <span class="kw">in</span> emit_results_df.index.to_list()]</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to GeoDataframe</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>emit_gdf <span class="op">=</span> gpd.GeoDataFrame(emit_results_df, geometry<span class="op">=</span>geometries, crs<span class="op">=</span><span class="st">"EPSG:4326"</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove emit_results_df, no longer needed</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> emit_results_df</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add browse imagery links</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>emit_gdf[<span class="st">'browse'</span>] <span class="op">=</span> [get_png(granule) <span class="cf">for</span> granule <span class="kw">in</span> emit_query_results]</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>emit_gdf[<span class="st">'shortname'</span>] <span class="op">=</span> [result[<span class="st">'umm'</span>][<span class="st">'CollectionReference'</span>][<span class="st">'ShortName'</span>] <span class="cf">for</span> result <span class="kw">in</span> emit_query_results]</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview GeoDataframe</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>emit_gdf<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> granules total'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>15 granules total</code></pre>
</div>
</div>
<p>Preview our geodataframe to get an idea what it looks like.</p>
<div id="cell-53" class="cell" data-tags="[]" data-execution_count="30">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>emit_gdf.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">meta.concept-type</th>
<th data-quarto-table-cell-role="th">meta.concept-id</th>
<th data-quarto-table-cell-role="th">meta.revision-id</th>
<th data-quarto-table-cell-role="th">meta.native-id</th>
<th data-quarto-table-cell-role="th">meta.collection-concept-id</th>
<th data-quarto-table-cell-role="th">meta.provider-id</th>
<th data-quarto-table-cell-role="th">meta.format</th>
<th data-quarto-table-cell-role="th">meta.revision-date</th>
<th data-quarto-table-cell-role="th">umm.TemporalExtent.RangeDateTime.BeginningDateTime</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">umm.DataGranule.DayNightFlag</th>
<th data-quarto-table-cell-role="th">umm.DataGranule.ArchiveAndDistributionInformation</th>
<th data-quarto-table-cell-role="th">umm.DataGranule.ProductionDateTime</th>
<th data-quarto-table-cell-role="th">umm.Platforms</th>
<th data-quarto-table-cell-role="th">umm.MetadataSpecification.URL</th>
<th data-quarto-table-cell-role="th">umm.MetadataSpecification.Name</th>
<th data-quarto-table-cell-role="th">umm.MetadataSpecification.Version</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">browse</th>
<th data-quarto-table-cell-role="th">shortname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3578.655884</td>
<td>granule</td>
<td>G2597398990-LPCLOUD</td>
<td>1</td>
<td>EMIT_L2A_RFL_001_20220816T210039_2222814_001</td>
<td>C2408750690-LPCLOUD</td>
<td>LPCLOUD</td>
<td>application/vnd.nasa.cmr.umm+json</td>
<td>2023-01-27T10:36:41.872Z</td>
<td>2022-08-16T21:00:39Z</td>
<td>...</td>
<td>Day</td>
<td>[{'Name': 'EMIT_L2A_RFL_001_20220816T210039_22...</td>
<td>2023-01-27T10:26:44Z</td>
<td>[{'ShortName': 'ISS', 'Instruments': [{'ShortN...</td>
<td>https://cdn.earthdata.nasa.gov/umm/granule/v1.6.6</td>
<td>UMM-G</td>
<td>1.6.6</td>
<td>POLYGON ((-105.64632 40.42052, -106.05467 39.7...</td>
<td>https://data.lpdaac.earthdatacloud.nasa.gov/lp...</td>
<td>EMITL2ARFL</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3581.975898</td>
<td>granule</td>
<td>G2597690501-LPCLOUD</td>
<td>1</td>
<td>EMIT_L2A_RFL_001_20220820T192256_2223213_003</td>
<td>C2408750690-LPCLOUD</td>
<td>LPCLOUD</td>
<td>application/vnd.nasa.cmr.umm+json</td>
<td>2023-01-28T00:54:23.821Z</td>
<td>2022-08-20T19:22:56Z</td>
<td>...</td>
<td>Day</td>
<td>[{'Name': 'EMIT_L2A_RFL_001_20220820T192256_22...</td>
<td>2023-01-28T00:42:40Z</td>
<td>[{'ShortName': 'ISS', 'Instruments': [{'ShortN...</td>
<td>https://cdn.earthdata.nasa.gov/umm/granule/v1.6.6</td>
<td>UMM-G</td>
<td>1.6.6</td>
<td>POLYGON ((-105.71240 41.02232, -106.10945 40.3...</td>
<td>https://data.lpdaac.earthdatacloud.nasa.gov/lp...</td>
<td>EMITL2ARFL</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3580.405610</td>
<td>granule</td>
<td>G2624104672-LPCLOUD</td>
<td>1</td>
<td>EMIT_L2A_RFL_001_20230203T185001_2303413_010</td>
<td>C2408750690-LPCLOUD</td>
<td>LPCLOUD</td>
<td>application/vnd.nasa.cmr.umm+json</td>
<td>2023-03-02T03:11:43.968Z</td>
<td>2023-02-03T18:50:01Z</td>
<td>...</td>
<td>Day</td>
<td>[{'Name': 'EMIT_L2A_RFL_001_20230203T185001_23...</td>
<td>2023-03-02T03:01:34Z</td>
<td>[{'ShortName': 'ISS', 'Instruments': [{'ShortN...</td>
<td>https://cdn.earthdata.nasa.gov/umm/granule/v1.6.6</td>
<td>UMM-G</td>
<td>1.6.6</td>
<td>POLYGON ((-105.33098 40.69196, -106.29222 40.1...</td>
<td>https://data.lpdaac.earthdatacloud.nasa.gov/lp...</td>
<td>EMITL2ARFL</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3578.689785</td>
<td>granule</td>
<td>G2646169485-LPCLOUD</td>
<td>1</td>
<td>EMIT_L2A_RFL_001_20230329T212754_2308814_017</td>
<td>C2408750690-LPCLOUD</td>
<td>LPCLOUD</td>
<td>application/vnd.nasa.cmr.umm+json</td>
<td>2023-04-02T02:42:57.159Z</td>
<td>2023-03-29T21:27:54Z</td>
<td>...</td>
<td>Day</td>
<td>[{'Name': 'EMIT_L2A_RFL_001_20230329T212754_23...</td>
<td>2023-04-02T02:32:39Z</td>
<td>[{'ShortName': 'ISS', 'Instruments': [{'ShortN...</td>
<td>https://cdn.earthdata.nasa.gov/umm/granule/v1.6.6</td>
<td>UMM-G</td>
<td>1.6.6</td>
<td>POLYGON ((-105.67938 40.79424, -106.64290 40.2...</td>
<td>https://data.lpdaac.earthdatacloud.nasa.gov/lp...</td>
<td>EMITL2ARFL</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3577.591364</td>
<td>granule</td>
<td>G2646169234-LPCLOUD</td>
<td>1</td>
<td>EMIT_L2A_RFL_001_20230329T212806_2308814_018</td>
<td>C2408750690-LPCLOUD</td>
<td>LPCLOUD</td>
<td>application/vnd.nasa.cmr.umm+json</td>
<td>2023-04-02T02:42:41.276Z</td>
<td>2023-03-29T21:28:06Z</td>
<td>...</td>
<td>Day</td>
<td>[{'Name': 'EMIT_L2A_RFL_001_20230329T212806_23...</td>
<td>2023-04-02T02:32:39Z</td>
<td>[{'ShortName': 'ISS', 'Instruments': [{'ShortN...</td>
<td>https://cdn.earthdata.nasa.gov/umm/granule/v1.6.6</td>
<td>UMM-G</td>
<td>1.6.6</td>
<td>POLYGON ((-104.90044 41.24032, -105.88304 40.6...</td>
<td>https://data.lpdaac.earthdatacloud.nasa.gov/lp...</td>
<td>EMITL2ARFL</td>
</tr>
</tbody>
</table>

<p>5 rows × 31 columns</p>
</div>
</div>
</div>
<p>There are a lot of columns with data that is not relevant for this exercise, so we can drop those. To do that, list the names of columns.</p>
<div id="cell-55" class="cell" data-tags="[]" data-execution_count="31">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List Column Names</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>emit_gdf.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>Index(['size', 'meta.concept-type', 'meta.concept-id', 'meta.revision-id',
       'meta.native-id', 'meta.collection-concept-id', 'meta.provider-id',
       'meta.format', 'meta.revision-date',
       'umm.TemporalExtent.RangeDateTime.BeginningDateTime',
       'umm.TemporalExtent.RangeDateTime.EndingDateTime', 'umm.GranuleUR',
       'umm.AdditionalAttributes',
       'umm.SpatialExtent.HorizontalSpatialDomain.Geometry.GPolygons',
       'umm.ProviderDates', 'umm.CollectionReference.ShortName',
       'umm.CollectionReference.Version', 'umm.PGEVersionClass.PGEName',
       'umm.PGEVersionClass.PGEVersion', 'umm.RelatedUrls', 'umm.CloudCover',
       'umm.DataGranule.DayNightFlag',
       'umm.DataGranule.ArchiveAndDistributionInformation',
       'umm.DataGranule.ProductionDateTime', 'umm.Platforms',
       'umm.MetadataSpecification.URL', 'umm.MetadataSpecification.Name',
       'umm.MetadataSpecification.Version', 'geometry', 'browse', 'shortname'],
      dtype='object')</code></pre>
</div>
</div>
<p>Now create a list of columns to keep and use it to filter the dataframe.</p>
<div id="cell-57" class="cell" data-tags="[]" data-execution_count="32">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list of columns to keep</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>keep_cols <span class="op">=</span> [<span class="st">'meta.concept-id'</span>,<span class="st">'meta.native-id'</span>, <span class="st">'umm.TemporalExtent.RangeDateTime.BeginningDateTime'</span>,<span class="st">'umm.TemporalExtent.RangeDateTime.EndingDateTime'</span>,<span class="st">'umm.CloudCover'</span>,<span class="st">'umm.DataGranule.DayNightFlag'</span>,<span class="st">'geometry'</span>,<span class="st">'browse'</span>, <span class="st">'shortname'</span>]</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove unneeded columns</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>emit_gdf <span class="op">=</span> emit_gdf[emit_gdf.columns.intersection(keep_cols)]</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>emit_gdf.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">meta.concept-id</th>
<th data-quarto-table-cell-role="th">meta.native-id</th>
<th data-quarto-table-cell-role="th">umm.TemporalExtent.RangeDateTime.BeginningDateTime</th>
<th data-quarto-table-cell-role="th">umm.TemporalExtent.RangeDateTime.EndingDateTime</th>
<th data-quarto-table-cell-role="th">umm.CloudCover</th>
<th data-quarto-table-cell-role="th">umm.DataGranule.DayNightFlag</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">browse</th>
<th data-quarto-table-cell-role="th">shortname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>G2597398990-LPCLOUD</td>
<td>EMIT_L2A_RFL_001_20220816T210039_2222814_001</td>
<td>2022-08-16T21:00:39Z</td>
<td>2022-08-16T21:00:51Z</td>
<td>98</td>
<td>Day</td>
<td>POLYGON ((-105.64632 40.42052, -106.05467 39.7...</td>
<td>https://data.lpdaac.earthdatacloud.nasa.gov/lp...</td>
<td>EMITL2ARFL</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>G2597690501-LPCLOUD</td>
<td>EMIT_L2A_RFL_001_20220820T192256_2223213_003</td>
<td>2022-08-20T19:22:56Z</td>
<td>2022-08-20T19:23:08Z</td>
<td>85</td>
<td>Day</td>
<td>POLYGON ((-105.71240 41.02232, -106.10945 40.3...</td>
<td>https://data.lpdaac.earthdatacloud.nasa.gov/lp...</td>
<td>EMITL2ARFL</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>G2624104672-LPCLOUD</td>
<td>EMIT_L2A_RFL_001_20230203T185001_2303413_010</td>
<td>2023-02-03T18:50:01Z</td>
<td>2023-02-03T18:50:13Z</td>
<td>95</td>
<td>Day</td>
<td>POLYGON ((-105.33098 40.69196, -106.29222 40.1...</td>
<td>https://data.lpdaac.earthdatacloud.nasa.gov/lp...</td>
<td>EMITL2ARFL</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>G2646169485-LPCLOUD</td>
<td>EMIT_L2A_RFL_001_20230329T212754_2308814_017</td>
<td>2023-03-29T21:27:54Z</td>
<td>2023-03-29T21:28:06Z</td>
<td>100</td>
<td>Day</td>
<td>POLYGON ((-105.67938 40.79424, -106.64290 40.2...</td>
<td>https://data.lpdaac.earthdatacloud.nasa.gov/lp...</td>
<td>EMITL2ARFL</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>G2646169234-LPCLOUD</td>
<td>EMIT_L2A_RFL_001_20230329T212806_2308814_018</td>
<td>2023-03-29T21:28:06Z</td>
<td>2023-03-29T21:28:17Z</td>
<td>96</td>
<td>Day</td>
<td>POLYGON ((-104.90044 41.24032, -105.88304 40.6...</td>
<td>https://data.lpdaac.earthdatacloud.nasa.gov/lp...</td>
<td>EMITL2ARFL</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This is looking better, but we can make it more readable by renaming our columns.</p>
<div id="cell-59" class="cell" data-tags="[]" data-execution_count="33">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename some Columns</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>emit_gdf.rename(columns <span class="op">=</span> {<span class="st">'meta.concept-id'</span>:<span class="st">'concept_id'</span>,<span class="st">'meta.native-id'</span>:<span class="st">'granule'</span>,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'umm.TemporalExtent.RangeDateTime.BeginningDateTime'</span>:<span class="st">'start_datetime'</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'umm.TemporalExtent.RangeDateTime.EndingDateTime'</span>:<span class="st">'end_datetime'</span>,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'umm.CloudCover'</span>:<span class="st">'cloud_cover'</span>,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'umm.DataGranule.DayNightFlag'</span>:<span class="st">'day_night'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>emit_gdf.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">concept_id</th>
<th data-quarto-table-cell-role="th">granule</th>
<th data-quarto-table-cell-role="th">start_datetime</th>
<th data-quarto-table-cell-role="th">end_datetime</th>
<th data-quarto-table-cell-role="th">cloud_cover</th>
<th data-quarto-table-cell-role="th">day_night</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">browse</th>
<th data-quarto-table-cell-role="th">shortname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>G2597398990-LPCLOUD</td>
<td>EMIT_L2A_RFL_001_20220816T210039_2222814_001</td>
<td>2022-08-16T21:00:39Z</td>
<td>2022-08-16T21:00:51Z</td>
<td>98</td>
<td>Day</td>
<td>POLYGON ((-105.64632 40.42052, -106.05467 39.7...</td>
<td>https://data.lpdaac.earthdatacloud.nasa.gov/lp...</td>
<td>EMITL2ARFL</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>G2597690501-LPCLOUD</td>
<td>EMIT_L2A_RFL_001_20220820T192256_2223213_003</td>
<td>2022-08-20T19:22:56Z</td>
<td>2022-08-20T19:23:08Z</td>
<td>85</td>
<td>Day</td>
<td>POLYGON ((-105.71240 41.02232, -106.10945 40.3...</td>
<td>https://data.lpdaac.earthdatacloud.nasa.gov/lp...</td>
<td>EMITL2ARFL</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>G2624104672-LPCLOUD</td>
<td>EMIT_L2A_RFL_001_20230203T185001_2303413_010</td>
<td>2023-02-03T18:50:01Z</td>
<td>2023-02-03T18:50:13Z</td>
<td>95</td>
<td>Day</td>
<td>POLYGON ((-105.33098 40.69196, -106.29222 40.1...</td>
<td>https://data.lpdaac.earthdatacloud.nasa.gov/lp...</td>
<td>EMITL2ARFL</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>G2646169485-LPCLOUD</td>
<td>EMIT_L2A_RFL_001_20230329T212754_2308814_017</td>
<td>2023-03-29T21:27:54Z</td>
<td>2023-03-29T21:28:06Z</td>
<td>100</td>
<td>Day</td>
<td>POLYGON ((-105.67938 40.79424, -106.64290 40.2...</td>
<td>https://data.lpdaac.earthdatacloud.nasa.gov/lp...</td>
<td>EMITL2ARFL</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>G2646169234-LPCLOUD</td>
<td>EMIT_L2A_RFL_001_20230329T212806_2308814_018</td>
<td>2023-03-29T21:28:06Z</td>
<td>2023-03-29T21:28:17Z</td>
<td>96</td>
<td>Day</td>
<td>POLYGON ((-104.90044 41.24032, -105.88304 40.6...</td>
<td>https://data.lpdaac.earthdatacloud.nasa.gov/lp...</td>
<td>EMITL2ARFL</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Note: If querying on-premises (not cloud) LP DAAC datasets, the <code>meta.concept-id</code> will not show as <code>xxxxxx-LPCLOUD</code>. For these datasets, the granule name can be retrieved from the <code>umm.DataGranule.Identifiers</code> column.</strong></p>
</blockquote>
<p>We can filter using the day/night flag as well, since we need a daytime collection to be comparable to the NEON data (which is captured at a high solar angle).</p>
<div id="cell-62" class="cell" data-tags="[]" data-execution_count="34">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># emit_gdf = emit_gdf[emit_gdf['day_night'].str.contains('Day')]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our first step toward filtering the datasets will be to add a column with a <code>datetime</code>.</p>
<blockquote class="blockquote">
<p><strong>You may have noticed that the date format is similar for ECOSTRESS and EMIT, but the ECOSTRESS data also includes fractional seconds. If working locally using <code>lpdaac_vitals</code> python environment, you may need to pass the <code>format='ISO8601'</code>argument to the <code>to_datetime</code> function, as shown in the commented-out line due to a difference in versions of pandas.</strong></p>
</blockquote>
<div id="cell-64" class="cell" data-tags="[]" data-execution_count="35">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#emit_gdf['datetime_obj'] = pd.to_datetime(emit_gdf['start_datetime']) # 2i2c</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>emit_gdf[<span class="st">'datetime_obj'</span>] <span class="op">=</span> pd.to_datetime(emit_gdf[<span class="st">'start_datetime'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'ISO8601'</span>) <span class="co"># Local ENV</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can roughly visualize the quantity of results by month at our location using a histogram with 8 bins (Jan - Oct).</p>
<div id="cell-66" class="cell" data-tags="[]" data-execution_count="36">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>emit_gdf.hist(column<span class="op">=</span><span class="st">'datetime_obj'</span>, by<span class="op">=</span><span class="st">'shortname'</span>, bins<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'green'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, sharey<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_Finding_Co-located_NEON_EMIT_Data_NIWO_files/figure-html/cell-37-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="visualizing-intersecting-coverage" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-intersecting-coverage">4. Visualizing Intersecting Coverage</h2>
<p>Now that we have geodataframes containing some co-located data, we can visualize them on a map using <code>folium</code>. It’s often difficult to visualize a large time-series of scenes, so we’ve included an example in Appendix A1 on how to filter to a single day.</p>
<div id="cell-68" class="cell" data-tags="[]" data-execution_count="37">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Using Folium</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure and Select Background Tiles</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> Figure(width<span class="op">=</span><span class="st">"750px"</span>, height<span class="op">=</span><span class="st">"375px"</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>map1 <span class="op">=</span> folium.Map(tiles<span class="op">=</span><span class="st">'https://mt1.google.com/vt/lyrs=y&amp;x=</span><span class="sc">{x}</span><span class="st">&amp;y=</span><span class="sc">{y}</span><span class="st">&amp;z=</span><span class="sc">{z}</span><span class="st">'</span>, attr<span class="op">=</span><span class="st">'Google'</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>fig.add_child(map1)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add NIWO Bounding Box</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>folium.GeoJson(niwo_bbox,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span><span class="st">'bounding_box'</span>,).add_to(map1)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add roi geodataframe</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>niwo_polygon.explore(<span class="st">"flightbxID"</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>                      popup<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>                      categorical<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>                      cmap<span class="op">=</span><span class="st">'Set3'</span>,</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>                      style_kwds<span class="op">=</span><span class="bu">dict</span>(opacity<span class="op">=</span><span class="fl">0.7</span>, fillOpacity<span class="op">=</span><span class="fl">0.4</span>),</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>                      name<span class="op">=</span><span class="st">"Niwot Ridge ROI"</span>,</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>                      m<span class="op">=</span>map1)</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot STAC EMITL2ARFL Results - note we must drop the datetime_obj columns for this to work</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>emit_gdf.drop(columns<span class="op">=</span>[<span class="st">'datetime_obj'</span>]).explore(</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"granule"</span>,</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>    categorical<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"granule"</span>,</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"start_datetime"</span>,</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cloud_cover"</span>,</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>    popup<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>    style_kwds<span class="op">=</span><span class="bu">dict</span>(fillOpacity<span class="op">=</span><span class="fl">0.1</span>, width<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"EMIT"</span>,</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>    m<span class="op">=</span>map1,</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">False</span></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>map1.fit_bounds(bounds<span class="op">=</span>convert_bounds(emit_gdf.unary_union.bounds))</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>map1.add_child(folium.LayerControl())</span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>display(fig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<iframe srcdoc="<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; />
    
        <script>
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        </script>
    
    <style>html, body {width: 100%;height: 100%;margin: 0;padding: 0;}</style>
    <style>#map {position:absolute;top:0;bottom:0;right:0;left:0;}</style>
    <script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;></script>
    <script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;></script>
    <script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;></script>
    <script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/>
    
            <meta name=&quot;viewport&quot; content=&quot;width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; />
            <style>
                #map_b9595961c4a280909e785deede57a96e {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>
        
    
                    <style>
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    </style>
            
    
                    <style>
                        .foliumpopup {
                            margin: auto;
                        }
                       .foliumpopup table{
                            margin: auto;
                        }
                        .foliumpopup tr{
                            text-align: left;
                        }
                        .foliumpopup th{
                            padding: 2px; padding-right: 8px;
                        }
                    </style>
            
    
                    <style>
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    </style>
            
    
                    <style>
                        .foliumpopup {
                            margin: auto;
                        }
                       .foliumpopup table{
                            margin: auto;
                        }
                        .foliumpopup tr{
                            text-align: left;
                        }
                        .foliumpopup th{
                            padding: 2px; padding-right: 8px;
                        }
                    </style>
            
    
    <script src=&quot;https://code.jquery.com/ui/1.12.1/jquery-ui.js&quot;></script>
    <script>$( function() {
        $( &quot;.maplegend&quot; ).draggable({
            start: function (event, ui) {
                $(this).css({
                    right: &quot;auto&quot;,
                    top: &quot;auto&quot;,
                    bottom: &quot;auto&quot;
                });
            }
        });
    });
    </script>
    <style type='text/css'>
      .maplegend {
        position: absolute;
        z-index:9999;
        background-color: rgba(255, 255, 255, .8);
        border-radius: 5px;
        box-shadow: 0 0 15px rgba(0,0,0,0.2);
        padding: 10px;
        font: 12px/14px Arial, Helvetica, sans-serif;
        right: 10px;
        bottom: 20px;
      }
      .maplegend .legend-title {
        text-align: left;
        margin-bottom: 5px;
        font-weight: bold;
        }
      .maplegend .legend-scale ul {
        margin: 0;
        margin-bottom: 0px;
        padding: 0;
        float: left;
        list-style: none;
        }
      .maplegend .legend-scale ul li {
        list-style: none;
        margin-left: 0;
        line-height: 16px;
        margin-bottom: 2px;
        }
      .maplegend ul.legend-labels li span {
        display: block;
        float: left;
        height: 14px;
        width: 14px;
        margin-right: 5px;
        margin-left: 0;
        border: 0px solid #ccc;
        }
      .maplegend .legend-source {
        color: #777;
        clear: both;
        }
      .maplegend a {
        color: #777;
        }
    </style>
    
</head>
<body>
    
    
    <div id='maplegend flightbxID' class='maplegend'>
        <div class='legend-title'>flightbxID</div>
        <div class='legend-scale'>
            <ul class='legend-labels'>
                <li><span style='background:#8dd3c7'></span>D13_NIWO_C1_P1_v2</li>
            </ul>
        </div>
    </div>
    
    
            <div class=&quot;folium-map&quot; id=&quot;map_b9595961c4a280909e785deede57a96e&quot; ></div>
        
</body>
<script>
    
    
            var map_b9595961c4a280909e785deede57a96e = L.map(
                &quot;map_b9595961c4a280909e785deede57a96e&quot;,
                {
                    center: [0.0, 0.0],
                    crs: L.CRS.EPSG3857,
                    zoom: 1,
                    zoomControl: true,
                    preferCanvas: false,
                }
            );

            

        
    
            var tile_layer_f61a6305350602c0c30529282d9c017a = L.tileLayer(
                &quot;https://mt1.google.com/vt/lyrs=y\u0026x={x}\u0026y={y}\u0026z={z}&quot;,
                {&quot;attribution&quot;: &quot;Google&quot;, &quot;detectRetina&quot;: false, &quot;maxZoom&quot;: 18, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            tile_layer_f61a6305350602c0c30529282d9c017a.addTo(map_b9595961c4a280909e785deede57a96e);
        
    

        function geo_json_75303ebaec3852add4194a90e14215b5_onEachFeature(feature, layer) {
            layer.on({
            });
        };
        var geo_json_75303ebaec3852add4194a90e14215b5 = L.geoJson(null, {
                onEachFeature: geo_json_75303ebaec3852add4194a90e14215b5_onEachFeature,
            
        });

        function geo_json_75303ebaec3852add4194a90e14215b5_add (data) {
            geo_json_75303ebaec3852add4194a90e14215b5
                .addData(data);
        }
            geo_json_75303ebaec3852add4194a90e14215b5_add({&quot;bbox&quot;: [-105.64788824641289, 39.98286247719818, -105.48907581013356, 40.07295974374222], &quot;features&quot;: [{&quot;bbox&quot;: [-105.64788824641289, 39.98286247719818, -105.48907581013356, 40.07295974374222], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.64788824641289, 39.98286247719818], [-105.48907581013356, 39.98286247719818], [-105.48907581013356, 40.07295974374222], [-105.64788824641289, 40.07295974374222], [-105.64788824641289, 39.98286247719818]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;Name&quot;: &quot;NIWO ROI Bounding Box&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});
        geo_json_75303ebaec3852add4194a90e14215b5.setStyle(function(feature) {return feature.properties.style;});

        
    
            geo_json_75303ebaec3852add4194a90e14215b5.addTo(map_b9595961c4a280909e785deede57a96e);
        
    
        function geo_json_6ef70122937b279e45af0757f52282fd_styler(feature) {
            switch(feature.id) {
                default:
                    return {&quot;color&quot;: &quot;#8dd3c7&quot;, &quot;fillColor&quot;: &quot;#8dd3c7&quot;, &quot;fillOpacity&quot;: 0.4, &quot;opacity&quot;: 0.7, &quot;weight&quot;: 2};
            }
        }
        function geo_json_6ef70122937b279e45af0757f52282fd_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_6ef70122937b279e45af0757f52282fd_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_6ef70122937b279e45af0757f52282fd_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_6ef70122937b279e45af0757f52282fd_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                            geo_json_6ef70122937b279e45af0757f52282fd.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_6ef70122937b279e45af0757f52282fd_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_6ef70122937b279e45af0757f52282fd = L.geoJson(null, {
                onEachFeature: geo_json_6ef70122937b279e45af0757f52282fd_onEachFeature,
            
                style: geo_json_6ef70122937b279e45af0757f52282fd_styler,
                pointToLayer: geo_json_6ef70122937b279e45af0757f52282fd_pointToLayer,
        });

        function geo_json_6ef70122937b279e45af0757f52282fd_add (data) {
            geo_json_6ef70122937b279e45af0757f52282fd
                .addData(data);
        }
            geo_json_6ef70122937b279e45af0757f52282fd_add({&quot;bbox&quot;: [-105.64788824641289, 39.98286247719818, -105.48907581013356, 40.07295974374222], &quot;features&quot;: [{&quot;bbox&quot;: [-105.64788824641289, 39.98286247719818, -105.48907581013356, 40.07295974374222], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.48907581013356, 40.07292430748697], [-105.48912180001292, 39.98286247719818], [-105.60625278516312, 39.982897848701725], [-105.6062315654986, 40.02432297671561], [-105.64739520015559, 40.024100318177716], [-105.64788824641289, 40.07275939845272], [-105.60620665139112, 40.07295974374222], [-105.48907581013356, 40.07292430748697]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;49&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#8dd3c7&quot;, &quot;domain&quot;: &quot;D13&quot;, &quot;flightbxID&quot;: &quot;D13_NIWO_C1_P1_v2&quot;, &quot;priority&quot;: 1, &quot;sampleType&quot;: &quot;Terrestrial&quot;, &quot;siteID&quot;: &quot;NIWO&quot;, &quot;siteName&quot;: &quot;Niwot Ridge NEON&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_6ef70122937b279e45af0757f52282fd.bindTooltip(
    function(layer){
    let div = L.DomUtil.create('div');
    
    let handleObject = feature=>typeof(feature)=='object' ? JSON.stringify(feature) : feature;
    let fields = [&quot;domain&quot;, &quot;siteName&quot;, &quot;siteID&quot;, &quot;sampleType&quot;, &quot;flightbxID&quot;, &quot;priority&quot;];
    let aliases = [&quot;domain&quot;, &quot;siteName&quot;, &quot;siteID&quot;, &quot;sampleType&quot;, &quot;flightbxID&quot;, &quot;priority&quot;];
    let table = '<table>' +
        String(
        fields.map(
        (v,i)=>
        `<tr>
            <th>${aliases[i]}</th>
            
            <td>${handleObject(layer.feature.properties[v])}</td>
        </tr>`).join(''))
    +'</table>';
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
    
    geo_json_6ef70122937b279e45af0757f52282fd.bindPopup(
    function(layer){
    let div = L.DomUtil.create('div');
    
    let handleObject = feature=>typeof(feature)=='object' ? JSON.stringify(feature) : feature;
    let fields = [&quot;domain&quot;, &quot;siteName&quot;, &quot;siteID&quot;, &quot;sampleType&quot;, &quot;flightbxID&quot;, &quot;priority&quot;];
    let aliases = [&quot;domain&quot;, &quot;siteName&quot;, &quot;siteID&quot;, &quot;sampleType&quot;, &quot;flightbxID&quot;, &quot;priority&quot;];
    let table = '<table>' +
        String(
        fields.map(
        (v,i)=>
        `<tr>
            <th>${aliases[i].toLocaleString()}</th>
            
            <td>${handleObject(layer.feature.properties[v]).toLocaleString()}</td>
        </tr>`).join(''))
    +'</table>';
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumpopup&quot;});
                     
    
            geo_json_6ef70122937b279e45af0757f52282fd.addTo(map_b9595961c4a280909e785deede57a96e);
        
    
        function geo_json_14afd9bee2c8ba15ac665f9bdaf4a789_styler(feature) {
            switch(feature.id) {
                case &quot;0&quot;: 
                    return {&quot;color&quot;: &quot;#1f77b4&quot;, &quot;fillColor&quot;: &quot;#1f77b4&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;1&quot;: 
                    return {&quot;color&quot;: &quot;#aec7e8&quot;, &quot;fillColor&quot;: &quot;#aec7e8&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;2&quot;: 
                    return {&quot;color&quot;: &quot;#ff7f0e&quot;, &quot;fillColor&quot;: &quot;#ff7f0e&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;3&quot;: 
                    return {&quot;color&quot;: &quot;#2ca02c&quot;, &quot;fillColor&quot;: &quot;#2ca02c&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;4&quot;: 
                    return {&quot;color&quot;: &quot;#98df8a&quot;, &quot;fillColor&quot;: &quot;#98df8a&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;5&quot;: 
                    return {&quot;color&quot;: &quot;#ff9896&quot;, &quot;fillColor&quot;: &quot;#ff9896&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;6&quot;: 
                    return {&quot;color&quot;: &quot;#9467bd&quot;, &quot;fillColor&quot;: &quot;#9467bd&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;7&quot;: 
                    return {&quot;color&quot;: &quot;#8c564b&quot;, &quot;fillColor&quot;: &quot;#8c564b&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;8&quot;: 
                    return {&quot;color&quot;: &quot;#c49c94&quot;, &quot;fillColor&quot;: &quot;#c49c94&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;10&quot;: 
                    return {&quot;color&quot;: &quot;#7f7f7f&quot;, &quot;fillColor&quot;: &quot;#7f7f7f&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;11&quot;: 
                    return {&quot;color&quot;: &quot;#c7c7c7&quot;, &quot;fillColor&quot;: &quot;#c7c7c7&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;12&quot;: 
                    return {&quot;color&quot;: &quot;#dbdb8d&quot;, &quot;fillColor&quot;: &quot;#dbdb8d&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;13&quot;: 
                    return {&quot;color&quot;: &quot;#17becf&quot;, &quot;fillColor&quot;: &quot;#17becf&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                case &quot;14&quot;: 
                    return {&quot;color&quot;: &quot;#9edae5&quot;, &quot;fillColor&quot;: &quot;#9edae5&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
                default:
                    return {&quot;color&quot;: &quot;#e377c2&quot;, &quot;fillColor&quot;: &quot;#e377c2&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
            }
        }
        function geo_json_14afd9bee2c8ba15ac665f9bdaf4a789_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_14afd9bee2c8ba15ac665f9bdaf4a789_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_14afd9bee2c8ba15ac665f9bdaf4a789_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_14afd9bee2c8ba15ac665f9bdaf4a789_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                            geo_json_14afd9bee2c8ba15ac665f9bdaf4a789.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_14afd9bee2c8ba15ac665f9bdaf4a789_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_14afd9bee2c8ba15ac665f9bdaf4a789 = L.geoJson(null, {
                onEachFeature: geo_json_14afd9bee2c8ba15ac665f9bdaf4a789_onEachFeature,
            
                style: geo_json_14afd9bee2c8ba15ac665f9bdaf4a789_styler,
                pointToLayer: geo_json_14afd9bee2c8ba15ac665f9bdaf4a789_pointToLayer,
        });

        function geo_json_14afd9bee2c8ba15ac665f9bdaf4a789_add (data) {
            geo_json_14afd9bee2c8ba15ac665f9bdaf4a789
                .addData(data);
        }
            geo_json_14afd9bee2c8ba15ac665f9bdaf4a789_add({&quot;bbox&quot;: [-106.64289855957031, 39.149845123291016, -104.37017822265625, 41.24032211303711], &quot;features&quot;: [{&quot;bbox&quot;: [-106.05467224121094, 39.23214340209961, -104.79750061035156, 40.4205207824707], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.64631652832031, 40.4205207824707], [-106.05467224121094, 39.746097564697266], [-105.20585632324219, 39.23214340209961], [-104.79750061035156, 39.90656661987305], [-105.64631652832031, 40.4205207824707]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#1f77b4&quot;, &quot;browse&quot;: &quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/EMITL2ARFL.001/EMIT_L2A_RFL_001_20220816T210039_2222814_001/EMIT_L2A_RFL_001_20220816T210039_2222814_001.png&quot;, &quot;cloud_cover&quot;: 98, &quot;concept_id&quot;: &quot;G2597398990-LPCLOUD&quot;, &quot;day_night&quot;: &quot;Day&quot;, &quot;end_datetime&quot;: &quot;2022-08-16T21:00:51Z&quot;, &quot;granule&quot;: &quot;EMIT_L2A_RFL_001_20220816T210039_2222814_001&quot;, &quot;shortname&quot;: &quot;EMITL2ARFL&quot;, &quot;start_datetime&quot;: &quot;2022-08-16T21:00:39Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-106.10945129394531, 39.83247375488281, -104.84043884277344, 41.022315979003906], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.71240234375, 41.022315979003906], [-106.10945129394531, 40.33958435058594], [-105.23748779296875, 39.83247375488281], [-104.84043884277344, 40.51520538330078], [-105.71240234375, 41.022315979003906]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;1&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#aec7e8&quot;, &quot;browse&quot;: &quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/EMITL2ARFL.001/EMIT_L2A_RFL_001_20220820T192256_2223213_003/EMIT_L2A_RFL_001_20220820T192256_2223213_003.png&quot;, &quot;cloud_cover&quot;: 85, &quot;concept_id&quot;: &quot;G2597690501-LPCLOUD&quot;, &quot;day_night&quot;: &quot;Day&quot;, &quot;end_datetime&quot;: &quot;2022-08-20T19:23:08Z&quot;, &quot;granule&quot;: &quot;EMIT_L2A_RFL_001_20220820T192256_2223213_003&quot;, &quot;shortname&quot;: &quot;EMITL2ARFL&quot;, &quot;start_datetime&quot;: &quot;2022-08-20T19:22:56Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-106.29222106933594, 39.43177795410156, -104.92146301269531, 40.69195556640625], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.33097839355469, 40.69195556640625], [-106.29222106933594, 40.11994171142578], [-105.88270568847656, 39.43177795410156], [-104.92146301269531, 40.00379180908203], [-105.33097839355469, 40.69195556640625]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;2&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#ff7f0e&quot;, &quot;browse&quot;: &quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/EMITL2ARFL.001/EMIT_L2A_RFL_001_20230203T185001_2303413_010/EMIT_L2A_RFL_001_20230203T185001_2303413_010.png&quot;, &quot;cloud_cover&quot;: 95, &quot;concept_id&quot;: &quot;G2624104672-LPCLOUD&quot;, &quot;day_night&quot;: &quot;Day&quot;, &quot;end_datetime&quot;: &quot;2023-02-03T18:50:13Z&quot;, &quot;granule&quot;: &quot;EMIT_L2A_RFL_001_20230203T185001_2303413_010&quot;, &quot;shortname&quot;: &quot;EMITL2ARFL&quot;, &quot;start_datetime&quot;: &quot;2023-02-03T18:50:01Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-106.64289855957031, 39.53754425048828, -105.27308654785156, 40.79423522949219], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.67938232421875, 40.79423522949219], [-106.64289855957031, 40.223670959472656], [-106.23660278320312, 39.53754425048828], [-105.27308654785156, 40.10810852050781], [-105.67938232421875, 40.79423522949219]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;3&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#2ca02c&quot;, &quot;browse&quot;: &quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/EMITL2ARFL.001/EMIT_L2A_RFL_001_20230329T212754_2308814_017/EMIT_L2A_RFL_001_20230329T212754_2308814_017.png&quot;, &quot;cloud_cover&quot;: 100, &quot;concept_id&quot;: &quot;G2646169485-LPCLOUD&quot;, &quot;day_night&quot;: &quot;Day&quot;, &quot;end_datetime&quot;: &quot;2023-03-29T21:28:06Z&quot;, &quot;granule&quot;: &quot;EMIT_L2A_RFL_001_20230329T212754_2308814_017&quot;, &quot;shortname&quot;: &quot;EMITL2ARFL&quot;, &quot;start_datetime&quot;: &quot;2023-03-29T21:27:54Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-105.88304138183594, 39.9845085144043, -104.50326538085938, 41.24032211303711], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-104.90043640136719, 41.24032211303711], [-105.88304138183594, 40.67570114135742], [-105.48587036132812, 39.9845085144043], [-104.50326538085938, 40.549129486083984], [-104.90043640136719, 41.24032211303711]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;4&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#98df8a&quot;, &quot;browse&quot;: &quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/EMITL2ARFL.001/EMIT_L2A_RFL_001_20230329T212806_2308814_018/EMIT_L2A_RFL_001_20230329T212806_2308814_018.png&quot;, &quot;cloud_cover&quot;: 96, &quot;concept_id&quot;: &quot;G2646169234-LPCLOUD&quot;, &quot;day_night&quot;: &quot;Day&quot;, &quot;end_datetime&quot;: &quot;2023-03-29T21:28:17Z&quot;, &quot;granule&quot;: &quot;EMIT_L2A_RFL_001_20230329T212806_2308814_018&quot;, &quot;shortname&quot;: &quot;EMITL2ARFL&quot;, &quot;start_datetime&quot;: &quot;2023-03-29T21:28:06Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-106.55433654785156, 39.52243423461914, -105.18360900878906, 40.78109359741211], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.59132385253906, 40.78109359741211], [-106.55433654785156, 40.2101936340332], [-106.14662170410156, 39.52243423461914], [-105.18360900878906, 40.09333419799805], [-105.59132385253906, 40.78109359741211]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;5&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#ff9896&quot;, &quot;browse&quot;: &quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/EMITL2ARFL.001/EMIT_L2A_RFL_001_20230402T195326_2309213_018/EMIT_L2A_RFL_001_20230402T195326_2309213_018.png&quot;, &quot;cloud_cover&quot;: 66, &quot;concept_id&quot;: &quot;G2650108200-LPCLOUD&quot;, &quot;day_night&quot;: &quot;Day&quot;, &quot;end_datetime&quot;: &quot;2023-04-02T19:53:37Z&quot;, &quot;granule&quot;: &quot;EMIT_L2A_RFL_001_20230402T195326_2309213_018&quot;, &quot;shortname&quot;: &quot;EMITL2ARFL&quot;, &quot;start_datetime&quot;: &quot;2023-04-02T19:53:26Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-106.19876098632812, 39.50210189819336, -104.82334899902344, 40.76897048950195], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.23623657226562, 40.76897048950195], [-106.19876098632812, 40.19736862182617], [-105.78587341308594, 39.50210189819336], [-104.82334899902344, 40.07370376586914], [-105.23623657226562, 40.76897048950195]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;6&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#9467bd&quot;, &quot;browse&quot;: &quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/EMITL2ARFL.001/EMIT_L2A_RFL_001_20230406T181842_2309612_019/EMIT_L2A_RFL_001_20230406T181842_2309612_019.png&quot;, &quot;cloud_cover&quot;: 63, &quot;concept_id&quot;: &quot;G2668218652-LPCLOUD&quot;, &quot;day_night&quot;: &quot;Day&quot;, &quot;end_datetime&quot;: &quot;2023-04-06T18:18:54Z&quot;, &quot;granule&quot;: &quot;EMIT_L2A_RFL_001_20230406T181842_2309612_019&quot;, &quot;shortname&quot;: &quot;EMITL2ARFL&quot;, &quot;start_datetime&quot;: &quot;2023-04-06T18:18:42Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-106.34947204589844, 39.473350524902344, -105.08016967773438, 40.67255401611328], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.94093322753906, 40.67255401611328], [-106.34947204589844, 39.9842529296875], [-105.48870849609375, 39.473350524902344], [-105.08016967773438, 40.161651611328125], [-105.94093322753906, 40.67255401611328]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;7&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#8c564b&quot;, &quot;browse&quot;: &quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/EMITL2ARFL.001/EMIT_L2A_RFL_001_20230418T200106_2310813_005/EMIT_L2A_RFL_001_20230418T200106_2310813_005.png&quot;, &quot;cloud_cover&quot;: 78, &quot;concept_id&quot;: &quot;G2660306579-LPCLOUD&quot;, &quot;day_night&quot;: &quot;Day&quot;, &quot;end_datetime&quot;: &quot;2023-04-18T20:01:18Z&quot;, &quot;granule&quot;: &quot;EMIT_L2A_RFL_001_20230418T200106_2310813_005&quot;, &quot;shortname&quot;: &quot;EMITL2ARFL&quot;, &quot;start_datetime&quot;: &quot;2023-04-18T20:01:06Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-106.55502319335938, 39.67430114746094, -105.18649291992188, 40.926185607910156], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.58848571777344, 40.926185607910156], [-106.55502319335938, 40.35736083984375], [-106.15303039550781, 39.67430114746094], [-105.18649291992188, 40.243125915527344], [-105.58848571777344, 40.926185607910156]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;8&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#c49c94&quot;, &quot;browse&quot;: &quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/EMITL2ARFL.001/EMIT_L2A_RFL_001_20230529T211859_2314914_020/EMIT_L2A_RFL_001_20230529T211859_2314914_020.png&quot;, &quot;cloud_cover&quot;: 99, &quot;concept_id&quot;: &quot;G2702497598-LPCLOUD&quot;, &quot;day_night&quot;: &quot;Day&quot;, &quot;end_datetime&quot;: &quot;2023-05-29T21:19:11Z&quot;, &quot;granule&quot;: &quot;EMIT_L2A_RFL_001_20230529T211859_2314914_020&quot;, &quot;shortname&quot;: &quot;EMITL2ARFL&quot;, &quot;start_datetime&quot;: &quot;2023-05-29T21:18:59Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-106.2873764038086, 39.1727409362793, -104.92948150634766, 40.423030853271484], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.33869171142578, 40.423030853271484], [-106.2873764038086, 39.848751068115234], [-105.87816619873047, 39.1727409362793], [-104.92948150634766, 39.74702072143555], [-105.33869171142578, 40.423030853271484]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;9&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#e377c2&quot;, &quot;browse&quot;: &quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/EMITL2ARFL.001/EMIT_L2A_RFL_001_20230602T194051_2315313_018/EMIT_L2A_RFL_001_20230602T194051_2315313_018.png&quot;, &quot;cloud_cover&quot;: 97, &quot;concept_id&quot;: &quot;G2719513326-LPCLOUD&quot;, &quot;day_night&quot;: &quot;Day&quot;, &quot;end_datetime&quot;: &quot;2023-06-02T19:41:02Z&quot;, &quot;granule&quot;: &quot;EMIT_L2A_RFL_001_20230602T194051_2315313_018&quot;, &quot;shortname&quot;: &quot;EMITL2ARFL&quot;, &quot;start_datetime&quot;: &quot;2023-06-02T19:40:51Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-106.3302001953125, 39.414066314697266, -105.0677490234375, 40.60380172729492], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.92611694335938, 40.60380172729492], [-106.3302001953125, 39.925174713134766], [-105.47183227539062, 39.414066314697266], [-105.0677490234375, 40.09269332885742], [-105.92611694335938, 40.60380172729492]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;10&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#7f7f7f&quot;, &quot;browse&quot;: &quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/EMITL2ARFL.001/EMIT_L2A_RFL_001_20230625T170814_2317611_005/EMIT_L2A_RFL_001_20230625T170814_2317611_005.png&quot;, &quot;cloud_cover&quot;: 8, &quot;concept_id&quot;: &quot;G2736967625-LPCLOUD&quot;, &quot;day_night&quot;: &quot;Day&quot;, &quot;end_datetime&quot;: &quot;2023-06-25T17:08:26Z&quot;, &quot;granule&quot;: &quot;EMIT_L2A_RFL_001_20230625T170814_2317611_005&quot;, &quot;shortname&quot;: &quot;EMITL2ARFL&quot;, &quot;start_datetime&quot;: &quot;2023-06-25T17:08:14Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-106.15153503417969, 39.58218765258789, -104.78437805175781, 40.83614730834961], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.18975830078125, 40.83614730834961], [-106.15153503417969, 40.26591873168945], [-105.74615478515625, 39.58218765258789], [-104.78437805175781, 40.15241622924805], [-105.18975830078125, 40.83614730834961]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;11&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#c7c7c7&quot;, &quot;browse&quot;: &quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/EMITL2ARFL.001/EMIT_L2A_RFL_001_20231002T192502_2327513_019/EMIT_L2A_RFL_001_20231002T192502_2327513_019.png&quot;, &quot;cloud_cover&quot;: 70, &quot;concept_id&quot;: &quot;G2781159853-LPCLOUD&quot;, &quot;day_night&quot;: &quot;Day&quot;, &quot;end_datetime&quot;: &quot;2023-10-02T19:25:14Z&quot;, &quot;granule&quot;: &quot;EMIT_L2A_RFL_001_20231002T192502_2327513_019&quot;, &quot;shortname&quot;: &quot;EMITL2ARFL&quot;, &quot;start_datetime&quot;: &quot;2023-10-02T19:25:02Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-106.255859375, 39.149845123291016, -104.89532470703125, 40.40256881713867], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.30499267578125, 40.40256881713867], [-106.255859375, 39.828983306884766], [-105.84619140625, 39.149845123291016], [-104.89532470703125, 39.72343063354492], [-105.30499267578125, 40.40256881713867]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;12&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#dbdb8d&quot;, &quot;browse&quot;: &quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/EMITL2ARFL.001/EMIT_L2A_RFL_001_20231006T174901_2327912_018/EMIT_L2A_RFL_001_20231006T174901_2327912_018.png&quot;, &quot;cloud_cover&quot;: 75, &quot;concept_id&quot;: &quot;G2779102527-LPCLOUD&quot;, &quot;day_night&quot;: &quot;Day&quot;, &quot;end_datetime&quot;: &quot;2023-10-06T17:49:12Z&quot;, &quot;granule&quot;: &quot;EMIT_L2A_RFL_001_20231006T174901_2327912_018&quot;, &quot;shortname&quot;: &quot;EMITL2ARFL&quot;, &quot;start_datetime&quot;: &quot;2023-10-06T17:49:01Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-106.39558410644531, 39.85380935668945, -105.12789916992188, 41.04121017456055], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-106.00013732910156, 41.04121017456055], [-106.39558410644531, 40.360591888427734], [-105.52334594726562, 39.85380935668945], [-105.12789916992188, 40.534427642822266], [-106.00013732910156, 41.04121017456055]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;13&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#17becf&quot;, &quot;browse&quot;: &quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/EMITL2ARFL.001/EMIT_L2A_RFL_001_20231014T210451_2328714_008/EMIT_L2A_RFL_001_20231014T210451_2328714_008.png&quot;, &quot;cloud_cover&quot;: 79, &quot;concept_id&quot;: &quot;G2784903072-LPCLOUD&quot;, &quot;day_night&quot;: &quot;Day&quot;, &quot;end_datetime&quot;: &quot;2023-10-14T21:05:03Z&quot;, &quot;granule&quot;: &quot;EMIT_L2A_RFL_001_20231014T210451_2328714_008&quot;, &quot;shortname&quot;: &quot;EMITL2ARFL&quot;, &quot;start_datetime&quot;: &quot;2023-10-14T21:04:51Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}, {&quot;bbox&quot;: [-105.62997436523438, 39.402950286865234, -104.37017822265625, 40.59249496459961], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.22320556640625, 40.59249496459961], [-105.62997436523438, 39.91543197631836], [-104.77694702148438, 39.402950286865234], [-104.37017822265625, 40.080013275146484], [-105.22320556640625, 40.59249496459961]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;14&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#9edae5&quot;, &quot;browse&quot;: &quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/EMITL2ARFL.001/EMIT_L2A_RFL_001_20231014T210503_2328714_009/EMIT_L2A_RFL_001_20231014T210503_2328714_009.png&quot;, &quot;cloud_cover&quot;: 62, &quot;concept_id&quot;: &quot;G2784901072-LPCLOUD&quot;, &quot;day_night&quot;: &quot;Day&quot;, &quot;end_datetime&quot;: &quot;2023-10-14T21:05:15Z&quot;, &quot;granule&quot;: &quot;EMIT_L2A_RFL_001_20231014T210503_2328714_009&quot;, &quot;shortname&quot;: &quot;EMITL2ARFL&quot;, &quot;start_datetime&quot;: &quot;2023-10-14T21:05:03Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_14afd9bee2c8ba15ac665f9bdaf4a789.bindTooltip(
    function(layer){
    let div = L.DomUtil.create('div');
    
    let handleObject = feature=>typeof(feature)=='object' ? JSON.stringify(feature) : feature;
    let fields = [&quot;granule&quot;, &quot;start_datetime&quot;, &quot;cloud_cover&quot;];
    let aliases = [&quot;granule&quot;, &quot;start_datetime&quot;, &quot;cloud_cover&quot;];
    let table = '<table>' +
        String(
        fields.map(
        (v,i)=>
        `<tr>
            <th>${aliases[i]}</th>
            
            <td>${handleObject(layer.feature.properties[v])}</td>
        </tr>`).join(''))
    +'</table>';
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
    
    geo_json_14afd9bee2c8ba15ac665f9bdaf4a789.bindPopup(
    function(layer){
    let div = L.DomUtil.create('div');
    
    let handleObject = feature=>typeof(feature)=='object' ? JSON.stringify(feature) : feature;
    let fields = [&quot;concept_id&quot;, &quot;granule&quot;, &quot;start_datetime&quot;, &quot;end_datetime&quot;, &quot;cloud_cover&quot;, &quot;day_night&quot;, &quot;browse&quot;, &quot;shortname&quot;];
    let aliases = [&quot;concept_id&quot;, &quot;granule&quot;, &quot;start_datetime&quot;, &quot;end_datetime&quot;, &quot;cloud_cover&quot;, &quot;day_night&quot;, &quot;browse&quot;, &quot;shortname&quot;];
    let table = '<table>' +
        String(
        fields.map(
        (v,i)=>
        `<tr>
            <th>${aliases[i].toLocaleString()}</th>
            
            <td>${handleObject(layer.feature.properties[v]).toLocaleString()}</td>
        </tr>`).join(''))
    +'</table>';
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumpopup&quot;});
                     
    
            geo_json_14afd9bee2c8ba15ac665f9bdaf4a789.addTo(map_b9595961c4a280909e785deede57a96e);
        
    
            map_b9595961c4a280909e785deede57a96e.fitBounds(
                [[39.149845123291016, -106.64289855957031], [41.24032211303711, -104.37017822265625]],
                {}
            );
        
    
            var layer_control_cdb254e3bd4a8d14f4c05d71d8451d70_layers = {
                base_layers : {
                    &quot;https://mt1.google.com/vt/lyrs=y\u0026x={x}\u0026y={y}\u0026z={z}&quot; : tile_layer_f61a6305350602c0c30529282d9c017a,
                },
                overlays :  {
                    &quot;bounding_box&quot; : geo_json_75303ebaec3852add4194a90e14215b5,
                    &quot;Niwot Ridge ROI&quot; : geo_json_6ef70122937b279e45af0757f52282fd,
                    &quot;EMIT&quot; : geo_json_14afd9bee2c8ba15ac665f9bdaf4a789,
                },
            };
            let layer_control_cdb254e3bd4a8d14f4c05d71d8451d70 = L.control.layers(
                layer_control_cdb254e3bd4a8d14f4c05d71d8451d70_layers.base_layers,
                layer_control_cdb254e3bd4a8d14f4c05d71d8451d70_layers.overlays,
                {&quot;autoZIndex&quot;: true, &quot;collapsed&quot;: true, &quot;position&quot;: &quot;topright&quot;}
            ).addTo(map_b9595961c4a280909e785deede57a96e);

        
</script>
</html>" width="750px" height="375px" style="border:none !important;" "allowfullscreen"="" "webkitallowfullscreen"="" "mozallowfullscreen"=""></iframe>
</div>
</div>
<section id="previewing-emit-browse-imagery" class="level3">
<h3 class="anchored" data-anchor-id="previewing-emit-browse-imagery">4.2 Previewing EMIT Browse Imagery</h3>
<p>The EMIT browse imagery is not orthorectified, so to get an idea what scenes look like, we can plot them in a grid using matplotlib.</p>
<blockquote class="blockquote">
<p>Note: The black space is indicative of onboard cloud masking that occurs before data is downlinked from the ISS.</p>
</blockquote>
<div id="cell-70" class="cell" data-tags="[]" data-execution_count="38">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> math.ceil(<span class="bu">len</span>(emit_gdf)<span class="op">/</span>cols)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(rows, cols, figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">20</span>))</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> ax.flatten()</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _n, index <span class="kw">in</span> <span class="bu">enumerate</span>(emit_gdf.index.to_list()):</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> io.imread(emit_gdf[<span class="st">'browse'</span>][index])</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    ax[_n].imshow(img)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    ax[_n].set_title(<span class="ss">f"Index: </span><span class="sc">{</span>index<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>emit_gdf[<span class="st">'granule'</span>][index]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    ax[_n].axis(<span class="st">'off'</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_Finding_Co-located_NEON_EMIT_Data_NIWO_files/figure-html/cell-39-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="further-filtering" class="level3">
<h3 class="anchored" data-anchor-id="further-filtering">4.3 Further Filtering</h3>
<p>We can see that some of these granules likely won’t work because of the large amount of cloud cover, we can use a list of these to filter them out. Make a list of indexes to filter out.</p>
<p>Filter out the bad granules.</p>
<div id="cell-73" class="cell" data-tags="[]" data-execution_count="39">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set a threshold for cloud cover and filter to remove scenes with &gt;50% cloud cover</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>emit_gdf_clear <span class="op">=</span> emit_gdf[emit_gdf.cloud_cover <span class="op">&lt;</span> <span class="dv">50</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-74" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>emit_gdf_clear</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">concept_id</th>
<th data-quarto-table-cell-role="th">granule</th>
<th data-quarto-table-cell-role="th">start_datetime</th>
<th data-quarto-table-cell-role="th">end_datetime</th>
<th data-quarto-table-cell-role="th">cloud_cover</th>
<th data-quarto-table-cell-role="th">day_night</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">browse</th>
<th data-quarto-table-cell-role="th">shortname</th>
<th data-quarto-table-cell-role="th">datetime_obj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>G2736967625-LPCLOUD</td>
<td>EMIT_L2A_RFL_001_20230625T170814_2317611_005</td>
<td>2023-06-25T17:08:14Z</td>
<td>2023-06-25T17:08:26Z</td>
<td>8</td>
<td>Day</td>
<td>POLYGON ((-105.92612 40.60380, -106.33020 39.9...</td>
<td>https://data.lpdaac.earthdatacloud.nasa.gov/lp...</td>
<td>EMITL2ARFL</td>
<td>2023-06-25 17:08:14+00:00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can see that there is only one scene with &lt;50% cloud cover. Luckily, this is captured in late June (June 25), which is close in time to when NEON typically surveys Niwot Ridge. NEON surveys during “peak-greenness”, when leaves are most photosynthetically active, which at NIWO usually occurs in July - August (in 2020 NIWO was surveyed on July 20, July 31, August 1, and August 7), in 2023 NIWO was surveyed on July 24, August 15, and August 21). Data from 2023 are not yet available from NEON.</p>
<p>Let’s take a look at the clear-weather EMIT dataset (Index 10):</p>
<ul>
<li><strong>10</strong>: <code>EMIT_L2A_RFL_001_20230625T170814_2317611_005</code></li>
</ul>
<p>We can plot this scene as follows:</p>
<div id="cell-76" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> io.imread(emit_gdf_clear[<span class="st">'browse'</span>][<span class="dv">10</span>])</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>ax.imshow(img)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f"</span><span class="sc">{</span>emit_gdf_clear[<span class="st">'granule'</span>][<span class="dv">10</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">'off'</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="01_Finding_Co-located_NEON_EMIT_Data_NIWO_files/figure-html/cell-42-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>We can now go back to our <code>folium</code> plot above and re-run the cell to update it based on our filtering.</strong></p>
<div id="cell-78" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Using Folium</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Figure and Select Background Tiles</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> Figure(width<span class="op">=</span><span class="st">"750px"</span>, height<span class="op">=</span><span class="st">"375px"</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>map1 <span class="op">=</span> folium.Map(tiles<span class="op">=</span><span class="st">'https://mt1.google.com/vt/lyrs=y&amp;x=</span><span class="sc">{x}</span><span class="st">&amp;y=</span><span class="sc">{y}</span><span class="st">&amp;z=</span><span class="sc">{z}</span><span class="st">'</span>, attr<span class="op">=</span><span class="st">'Google'</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>fig.add_child(map1)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add NIWO Bounding Box</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>folium.GeoJson(niwo_bbox,</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span><span class="st">'bounding_box'</span>,</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>                ).add_to(map1)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add roi geodataframe</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>niwo_polygon.explore(<span class="st">"flightbxID"</span>,</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>                      popup<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>                      categorical<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>                      cmap<span class="op">=</span><span class="st">'Set3'</span>,</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>                      style_kwds<span class="op">=</span><span class="bu">dict</span>(opacity<span class="op">=</span><span class="fl">0.7</span>, fillOpacity<span class="op">=</span><span class="fl">0.4</span>),</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>                      name<span class="op">=</span><span class="st">"Niwot Ridge ROI"</span>,</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>                      m<span class="op">=</span>map1)</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot STAC EMITL2ARFL Results - note we must drop the datetime_obj columns for this to work</span></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>emit_gdf_clear.drop(columns<span class="op">=</span>[<span class="st">'datetime_obj'</span>]).explore(</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"granule"</span>,</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>    categorical<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"granule"</span>,</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"start_datetime"</span>,</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cloud_cover"</span>,</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>    popup<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>    style_kwds<span class="op">=</span><span class="bu">dict</span>(fillOpacity<span class="op">=</span><span class="fl">0.1</span>, width<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"EMIT"</span>,</span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>    m<span class="op">=</span>map1,</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">False</span></span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a>map1.fit_bounds(bounds<span class="op">=</span>convert_bounds(emit_gdf.unary_union.bounds))</span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>map1.add_child(folium.LayerControl())</span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a>display(fig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<iframe srcdoc="<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; />
    
        <script>
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        </script>
    
    <style>html, body {width: 100%;height: 100%;margin: 0;padding: 0;}</style>
    <style>#map {position:absolute;top:0;bottom:0;right:0;left:0;}</style>
    <script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;></script>
    <script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;></script>
    <script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;></script>
    <script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;></script>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/>
    <link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/>
    
            <meta name=&quot;viewport&quot; content=&quot;width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; />
            <style>
                #map_5bec202c40aa796ac2ef4c64077d57b8 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>
        
    
                    <style>
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    </style>
            
    
                    <style>
                        .foliumpopup {
                            margin: auto;
                        }
                       .foliumpopup table{
                            margin: auto;
                        }
                        .foliumpopup tr{
                            text-align: left;
                        }
                        .foliumpopup th{
                            padding: 2px; padding-right: 8px;
                        }
                    </style>
            
    
                    <style>
                        .foliumtooltip {
                            
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                    </style>
            
    
                    <style>
                        .foliumpopup {
                            margin: auto;
                        }
                       .foliumpopup table{
                            margin: auto;
                        }
                        .foliumpopup tr{
                            text-align: left;
                        }
                        .foliumpopup th{
                            padding: 2px; padding-right: 8px;
                        }
                    </style>
            
    
    <script src=&quot;https://code.jquery.com/ui/1.12.1/jquery-ui.js&quot;></script>
    <script>$( function() {
        $( &quot;.maplegend&quot; ).draggable({
            start: function (event, ui) {
                $(this).css({
                    right: &quot;auto&quot;,
                    top: &quot;auto&quot;,
                    bottom: &quot;auto&quot;
                });
            }
        });
    });
    </script>
    <style type='text/css'>
      .maplegend {
        position: absolute;
        z-index:9999;
        background-color: rgba(255, 255, 255, .8);
        border-radius: 5px;
        box-shadow: 0 0 15px rgba(0,0,0,0.2);
        padding: 10px;
        font: 12px/14px Arial, Helvetica, sans-serif;
        right: 10px;
        bottom: 20px;
      }
      .maplegend .legend-title {
        text-align: left;
        margin-bottom: 5px;
        font-weight: bold;
        }
      .maplegend .legend-scale ul {
        margin: 0;
        margin-bottom: 0px;
        padding: 0;
        float: left;
        list-style: none;
        }
      .maplegend .legend-scale ul li {
        list-style: none;
        margin-left: 0;
        line-height: 16px;
        margin-bottom: 2px;
        }
      .maplegend ul.legend-labels li span {
        display: block;
        float: left;
        height: 14px;
        width: 14px;
        margin-right: 5px;
        margin-left: 0;
        border: 0px solid #ccc;
        }
      .maplegend .legend-source {
        color: #777;
        clear: both;
        }
      .maplegend a {
        color: #777;
        }
    </style>
    
</head>
<body>
    
    
    <div id='maplegend flightbxID' class='maplegend'>
        <div class='legend-title'>flightbxID</div>
        <div class='legend-scale'>
            <ul class='legend-labels'>
                <li><span style='background:#8dd3c7'></span>D13_NIWO_C1_P1_v2</li>
            </ul>
        </div>
    </div>
    
    
            <div class=&quot;folium-map&quot; id=&quot;map_5bec202c40aa796ac2ef4c64077d57b8&quot; ></div>
        
</body>
<script>
    
    
            var map_5bec202c40aa796ac2ef4c64077d57b8 = L.map(
                &quot;map_5bec202c40aa796ac2ef4c64077d57b8&quot;,
                {
                    center: [0.0, 0.0],
                    crs: L.CRS.EPSG3857,
                    zoom: 1,
                    zoomControl: true,
                    preferCanvas: false,
                }
            );

            

        
    
            var tile_layer_a86a650dc1278eb2f84d03d7e8e84dd6 = L.tileLayer(
                &quot;https://mt1.google.com/vt/lyrs=y\u0026x={x}\u0026y={y}\u0026z={z}&quot;,
                {&quot;attribution&quot;: &quot;Google&quot;, &quot;detectRetina&quot;: false, &quot;maxZoom&quot;: 18, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            tile_layer_a86a650dc1278eb2f84d03d7e8e84dd6.addTo(map_5bec202c40aa796ac2ef4c64077d57b8);
        
    

        function geo_json_f8443d9627eb426f11a1a26180222ee7_onEachFeature(feature, layer) {
            layer.on({
            });
        };
        var geo_json_f8443d9627eb426f11a1a26180222ee7 = L.geoJson(null, {
                onEachFeature: geo_json_f8443d9627eb426f11a1a26180222ee7_onEachFeature,
            
        });

        function geo_json_f8443d9627eb426f11a1a26180222ee7_add (data) {
            geo_json_f8443d9627eb426f11a1a26180222ee7
                .addData(data);
        }
            geo_json_f8443d9627eb426f11a1a26180222ee7_add({&quot;bbox&quot;: [-105.64788824641289, 39.98286247719818, -105.48907581013356, 40.07295974374222], &quot;features&quot;: [{&quot;bbox&quot;: [-105.64788824641289, 39.98286247719818, -105.48907581013356, 40.07295974374222], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.64788824641289, 39.98286247719818], [-105.48907581013356, 39.98286247719818], [-105.48907581013356, 40.07295974374222], [-105.64788824641289, 40.07295974374222], [-105.64788824641289, 39.98286247719818]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;0&quot;, &quot;properties&quot;: {&quot;Name&quot;: &quot;NIWO ROI Bounding Box&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});
        geo_json_f8443d9627eb426f11a1a26180222ee7.setStyle(function(feature) {return feature.properties.style;});

        
    
            geo_json_f8443d9627eb426f11a1a26180222ee7.addTo(map_5bec202c40aa796ac2ef4c64077d57b8);
        
    
        function geo_json_f03645f32c8d7fba7a1d1d12b8a0c368_styler(feature) {
            switch(feature.id) {
                default:
                    return {&quot;color&quot;: &quot;#8dd3c7&quot;, &quot;fillColor&quot;: &quot;#8dd3c7&quot;, &quot;fillOpacity&quot;: 0.4, &quot;opacity&quot;: 0.7, &quot;weight&quot;: 2};
            }
        }
        function geo_json_f03645f32c8d7fba7a1d1d12b8a0c368_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_f03645f32c8d7fba7a1d1d12b8a0c368_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_f03645f32c8d7fba7a1d1d12b8a0c368_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_f03645f32c8d7fba7a1d1d12b8a0c368_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                            geo_json_f03645f32c8d7fba7a1d1d12b8a0c368.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_f03645f32c8d7fba7a1d1d12b8a0c368_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_f03645f32c8d7fba7a1d1d12b8a0c368 = L.geoJson(null, {
                onEachFeature: geo_json_f03645f32c8d7fba7a1d1d12b8a0c368_onEachFeature,
            
                style: geo_json_f03645f32c8d7fba7a1d1d12b8a0c368_styler,
                pointToLayer: geo_json_f03645f32c8d7fba7a1d1d12b8a0c368_pointToLayer,
        });

        function geo_json_f03645f32c8d7fba7a1d1d12b8a0c368_add (data) {
            geo_json_f03645f32c8d7fba7a1d1d12b8a0c368
                .addData(data);
        }
            geo_json_f03645f32c8d7fba7a1d1d12b8a0c368_add({&quot;bbox&quot;: [-105.64788824641289, 39.98286247719818, -105.48907581013356, 40.07295974374222], &quot;features&quot;: [{&quot;bbox&quot;: [-105.64788824641289, 39.98286247719818, -105.48907581013356, 40.07295974374222], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.48907581013356, 40.07292430748697], [-105.48912180001292, 39.98286247719818], [-105.60625278516312, 39.982897848701725], [-105.6062315654986, 40.02432297671561], [-105.64739520015559, 40.024100318177716], [-105.64788824641289, 40.07275939845272], [-105.60620665139112, 40.07295974374222], [-105.48907581013356, 40.07292430748697]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;49&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#8dd3c7&quot;, &quot;domain&quot;: &quot;D13&quot;, &quot;flightbxID&quot;: &quot;D13_NIWO_C1_P1_v2&quot;, &quot;priority&quot;: 1, &quot;sampleType&quot;: &quot;Terrestrial&quot;, &quot;siteID&quot;: &quot;NIWO&quot;, &quot;siteName&quot;: &quot;Niwot Ridge NEON&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_f03645f32c8d7fba7a1d1d12b8a0c368.bindTooltip(
    function(layer){
    let div = L.DomUtil.create('div');
    
    let handleObject = feature=>typeof(feature)=='object' ? JSON.stringify(feature) : feature;
    let fields = [&quot;domain&quot;, &quot;siteName&quot;, &quot;siteID&quot;, &quot;sampleType&quot;, &quot;flightbxID&quot;, &quot;priority&quot;];
    let aliases = [&quot;domain&quot;, &quot;siteName&quot;, &quot;siteID&quot;, &quot;sampleType&quot;, &quot;flightbxID&quot;, &quot;priority&quot;];
    let table = '<table>' +
        String(
        fields.map(
        (v,i)=>
        `<tr>
            <th>${aliases[i]}</th>
            
            <td>${handleObject(layer.feature.properties[v])}</td>
        </tr>`).join(''))
    +'</table>';
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
    
    geo_json_f03645f32c8d7fba7a1d1d12b8a0c368.bindPopup(
    function(layer){
    let div = L.DomUtil.create('div');
    
    let handleObject = feature=>typeof(feature)=='object' ? JSON.stringify(feature) : feature;
    let fields = [&quot;domain&quot;, &quot;siteName&quot;, &quot;siteID&quot;, &quot;sampleType&quot;, &quot;flightbxID&quot;, &quot;priority&quot;];
    let aliases = [&quot;domain&quot;, &quot;siteName&quot;, &quot;siteID&quot;, &quot;sampleType&quot;, &quot;flightbxID&quot;, &quot;priority&quot;];
    let table = '<table>' +
        String(
        fields.map(
        (v,i)=>
        `<tr>
            <th>${aliases[i].toLocaleString()}</th>
            
            <td>${handleObject(layer.feature.properties[v]).toLocaleString()}</td>
        </tr>`).join(''))
    +'</table>';
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumpopup&quot;});
                     
    
            geo_json_f03645f32c8d7fba7a1d1d12b8a0c368.addTo(map_5bec202c40aa796ac2ef4c64077d57b8);
        
    
        function geo_json_6a145996ff30e5d1bf31763d54ca86b8_styler(feature) {
            switch(feature.id) {
                default:
                    return {&quot;color&quot;: &quot;#1f77b4&quot;, &quot;fillColor&quot;: &quot;#1f77b4&quot;, &quot;fillOpacity&quot;: 0.1, &quot;weight&quot;: 2, &quot;width&quot;: 2};
            }
        }
        function geo_json_6a145996ff30e5d1bf31763d54ca86b8_highlighter(feature) {
            switch(feature.id) {
                default:
                    return {&quot;fillOpacity&quot;: 0.75};
            }
        }
        function geo_json_6a145996ff30e5d1bf31763d54ca86b8_pointToLayer(feature, latlng) {
            var opts = {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;#3388ff&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;#3388ff&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 2, &quot;stroke&quot;: true, &quot;weight&quot;: 3};
            
            let style = geo_json_6a145996ff30e5d1bf31763d54ca86b8_styler(feature)
            Object.assign(opts, style)
            
            return new L.CircleMarker(latlng, opts)
        }

        function geo_json_6a145996ff30e5d1bf31763d54ca86b8_onEachFeature(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                            geo_json_6a145996ff30e5d1bf31763d54ca86b8.resetStyle(e.target);
                    }
                },
                mouseover: function(e) {
                    if(typeof e.target.setStyle === &quot;function&quot;){
                        const highlightStyle = geo_json_6a145996ff30e5d1bf31763d54ca86b8_highlighter(e.target.feature)
                        e.target.setStyle(highlightStyle);
                    }
                },
            });
        };
        var geo_json_6a145996ff30e5d1bf31763d54ca86b8 = L.geoJson(null, {
                onEachFeature: geo_json_6a145996ff30e5d1bf31763d54ca86b8_onEachFeature,
            
                style: geo_json_6a145996ff30e5d1bf31763d54ca86b8_styler,
                pointToLayer: geo_json_6a145996ff30e5d1bf31763d54ca86b8_pointToLayer,
        });

        function geo_json_6a145996ff30e5d1bf31763d54ca86b8_add (data) {
            geo_json_6a145996ff30e5d1bf31763d54ca86b8
                .addData(data);
        }
            geo_json_6a145996ff30e5d1bf31763d54ca86b8_add({&quot;bbox&quot;: [-106.3302001953125, 39.414066314697266, -105.0677490234375, 40.60380172729492], &quot;features&quot;: [{&quot;bbox&quot;: [-106.3302001953125, 39.414066314697266, -105.0677490234375, 40.60380172729492], &quot;geometry&quot;: {&quot;coordinates&quot;: [[[-105.92611694335938, 40.60380172729492], [-106.3302001953125, 39.925174713134766], [-105.47183227539062, 39.414066314697266], [-105.0677490234375, 40.09269332885742], [-105.92611694335938, 40.60380172729492]]], &quot;type&quot;: &quot;Polygon&quot;}, &quot;id&quot;: &quot;10&quot;, &quot;properties&quot;: {&quot;__folium_color&quot;: &quot;#1f77b4&quot;, &quot;browse&quot;: &quot;https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-public/EMITL2ARFL.001/EMIT_L2A_RFL_001_20230625T170814_2317611_005/EMIT_L2A_RFL_001_20230625T170814_2317611_005.png&quot;, &quot;cloud_cover&quot;: 8, &quot;concept_id&quot;: &quot;G2736967625-LPCLOUD&quot;, &quot;day_night&quot;: &quot;Day&quot;, &quot;end_datetime&quot;: &quot;2023-06-25T17:08:26Z&quot;, &quot;granule&quot;: &quot;EMIT_L2A_RFL_001_20230625T170814_2317611_005&quot;, &quot;shortname&quot;: &quot;EMITL2ARFL&quot;, &quot;start_datetime&quot;: &quot;2023-06-25T17:08:14Z&quot;}, &quot;type&quot;: &quot;Feature&quot;}], &quot;type&quot;: &quot;FeatureCollection&quot;});

        
    
    geo_json_6a145996ff30e5d1bf31763d54ca86b8.bindTooltip(
    function(layer){
    let div = L.DomUtil.create('div');
    
    let handleObject = feature=>typeof(feature)=='object' ? JSON.stringify(feature) : feature;
    let fields = [&quot;granule&quot;, &quot;start_datetime&quot;, &quot;cloud_cover&quot;];
    let aliases = [&quot;granule&quot;, &quot;start_datetime&quot;, &quot;cloud_cover&quot;];
    let table = '<table>' +
        String(
        fields.map(
        (v,i)=>
        `<tr>
            <th>${aliases[i]}</th>
            
            <td>${handleObject(layer.feature.properties[v])}</td>
        </tr>`).join(''))
    +'</table>';
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumtooltip&quot;, &quot;sticky&quot;: true});
                     
    
    geo_json_6a145996ff30e5d1bf31763d54ca86b8.bindPopup(
    function(layer){
    let div = L.DomUtil.create('div');
    
    let handleObject = feature=>typeof(feature)=='object' ? JSON.stringify(feature) : feature;
    let fields = [&quot;concept_id&quot;, &quot;granule&quot;, &quot;start_datetime&quot;, &quot;end_datetime&quot;, &quot;cloud_cover&quot;, &quot;day_night&quot;, &quot;browse&quot;, &quot;shortname&quot;];
    let aliases = [&quot;concept_id&quot;, &quot;granule&quot;, &quot;start_datetime&quot;, &quot;end_datetime&quot;, &quot;cloud_cover&quot;, &quot;day_night&quot;, &quot;browse&quot;, &quot;shortname&quot;];
    let table = '<table>' +
        String(
        fields.map(
        (v,i)=>
        `<tr>
            <th>${aliases[i].toLocaleString()}</th>
            
            <td>${handleObject(layer.feature.properties[v]).toLocaleString()}</td>
        </tr>`).join(''))
    +'</table>';
    div.innerHTML=table;
    
    return div
    }
    ,{&quot;className&quot;: &quot;foliumpopup&quot;});
                     
    
            geo_json_6a145996ff30e5d1bf31763d54ca86b8.addTo(map_5bec202c40aa796ac2ef4c64077d57b8);
        
    
            map_5bec202c40aa796ac2ef4c64077d57b8.fitBounds(
                [[39.149845123291016, -106.64289855957031], [41.24032211303711, -104.37017822265625]],
                {}
            );
        
    
            var layer_control_effbac17de94f8e10c9ef88382996e74_layers = {
                base_layers : {
                    &quot;https://mt1.google.com/vt/lyrs=y\u0026x={x}\u0026y={y}\u0026z={z}&quot; : tile_layer_a86a650dc1278eb2f84d03d7e8e84dd6,
                },
                overlays :  {
                    &quot;bounding_box&quot; : geo_json_f8443d9627eb426f11a1a26180222ee7,
                    &quot;Niwot Ridge ROI&quot; : geo_json_f03645f32c8d7fba7a1d1d12b8a0c368,
                    &quot;EMIT&quot; : geo_json_6a145996ff30e5d1bf31763d54ca86b8,
                },
            };
            let layer_control_effbac17de94f8e10c9ef88382996e74 = L.control.layers(
                layer_control_effbac17de94f8e10c9ef88382996e74_layers.base_layers,
                layer_control_effbac17de94f8e10c9ef88382996e74_layers.overlays,
                {&quot;autoZIndex&quot;: true, &quot;collapsed&quot;: true, &quot;position&quot;: &quot;topright&quot;}
            ).addTo(map_5bec202c40aa796ac2ef4c64077d57b8);

        
</script>
</html>" width="750px" height="375px" style="border:none !important;" "allowfullscreen"="" "webkitallowfullscreen"="" "mozallowfullscreen"=""></iframe>
</div>
</div>
</section>
</section>
<section id="generating-a-list-of-urls-and-downloading-data" class="level2">
<h2 class="anchored" data-anchor-id="generating-a-list-of-urls-and-downloading-data">5. Generating a list of URLs and downloading data</h2>
<p>Creating a list of results URLs will include all of these assets, so if we only want a subset we need an additional filter to keep the specific assets we want.</p>
<p>If you look back, you can see we kept the same indexing throughout the notebook. This enables us to simply subset the <code>earthaccess</code> results object to retrieve the results we want.</p>
<p>Create a list of index values to keep.</p>
<div id="cell-80" class="cell" data-tags="[]" data-execution_count="43">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>keep_granules <span class="op">=</span> [<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Filter the results list.</p>
<div id="cell-82" class="cell" data-tags="[]" data-execution_count="44">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>filtered_results <span class="op">=</span> [result <span class="cf">for</span> i, result <span class="kw">in</span> <span class="bu">enumerate</span>(emit_query_results) <span class="cf">if</span> i <span class="kw">in</span> keep_granules]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can download all of the associated assets, or retrieve the URLS and further filter them to specifically what we want.</p>
<p>First, log into Earthdata using the <code>login</code> function from the <code>earthaccess</code> library. The <code>persist=True</code> argument will create a local <code>.netrc</code> file if it doesn’t exist, or add your login info to an existing <code>.netrc</code> file. If no Earthdata Login credentials are found in the <code>.netrc</code> you’ll be prompted for them. As mentioned in section 1.2, this step is not necessary to conduct searches, but is needed to download or stream data.</p>
<p>Now we can download all assets using the following cell.</p>
<div id="cell-85" class="cell" data-tags="[]" data-execution_count="45">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download All Assets for Granules in Filtered Results</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co">#earthaccess.download(filtered_results, '../data/NIWO/emit_refl')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or we can create a list of URLs and use that to further refine which files we download.</p>
<div id="cell-87" class="cell" data-tags="[]" data-execution_count="46">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve URLS for Assets</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>results_urls <span class="op">=</span> [granule.data_links() <span class="cf">for</span> granule <span class="kw">in</span> filtered_results]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-88" class="cell" data-tags="[]" data-execution_count="47">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>results_urls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>[['https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL2ARFL.001/EMIT_L2A_RFL_001_20230625T170814_2317611_005/EMIT_L2A_RFL_001_20230625T170814_2317611_005.nc',
  'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL2ARFL.001/EMIT_L2A_RFL_001_20230625T170814_2317611_005/EMIT_L2A_RFLUNCERT_001_20230625T170814_2317611_005.nc',
  'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL2ARFL.001/EMIT_L2A_RFL_001_20230625T170814_2317611_005/EMIT_L2A_MASK_001_20230625T170814_2317611_005.nc']]</code></pre>
</div>
</div>
<p>We can see this is a nested list. Granules often have several assets associated with them, for example, <code>EMIT_L2A</code> has several assets:</p>
<ul>
<li>RFL</li>
<li>RFLUNCERT</li>
<li>MASK</li>
</ul>
<p>The results list we just generated contains URLs to all of these assets nested by granule. We can further filter our results list using string matching to remove unwanted assets.</p>
<p>Create a list of strings and enumerate through our results_url list to filter out unwanted assets and remove the nesting.</p>
<div id="cell-90" class="cell" data-tags="[]" data-execution_count="48">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>filtered_asset_links <span class="op">=</span> []</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Pick Desired Assets (leave _ on RFL to distinguish from RFLUNC, LST. to distinguish from LST_err)</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>desired_assets <span class="op">=</span> [<span class="st">'RFL_'</span>,<span class="st">'MASK'</span>, <span class="st">'LST.'</span>] <span class="co"># Add more or do individually for reflectance, reflectance uncertainty, or mask</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Step through each sublist (granule) and filter based on desired assets.</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n, granule <span class="kw">in</span> <span class="bu">enumerate</span>(results_urls):</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> url <span class="kw">in</span> granule: </span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>        asset_name <span class="op">=</span> url.split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">any</span>(asset <span class="kw">in</span> asset_name <span class="cf">for</span> asset <span class="kw">in</span> desired_assets):</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>            filtered_asset_links.append(url)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>filtered_asset_links</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>['https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL2ARFL.001/EMIT_L2A_RFL_001_20230625T170814_2317611_005/EMIT_L2A_RFL_001_20230625T170814_2317611_005.nc',
 'https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/EMITL2ARFL.001/EMIT_L2A_RFL_001_20230625T170814_2317611_005/EMIT_L2A_MASK_001_20230625T170814_2317611_005.nc']</code></pre>
</div>
</div>
<p>We can see that this removed the <code>REFLUNCERT</code> data. We can also write this list of files to a text file to have a record of data used, or stream the data using <code>https</code> as we access them. For streaming the data, the EMIT files are very large, so operations can take some time.</p>
<div id="cell-92" class="cell" data-tags="[]" data-execution_count="49">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'./data/emit_search_results.txt'</span>, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> line <span class="kw">in</span> filtered_asset_links:</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>        f.write(<span class="ss">f"</span><span class="sc">{</span>line<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Open the list of required granules.</p>
<blockquote class="blockquote">
<p>Note: You can download all of the files using the cell below and recreate all of the canopy water content files following a workflow similar to the example in notebooks 2 and 3 for all of the necessary scenes. To do this, uncomment the <code>file_list</code> object with the <code>emit_search_results.txt</code> filepath to download all of the results rather than just what is required.</p>
</blockquote>
<div id="cell-94" class="cell" data-tags="[]" data-execution_count="50">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open Text File and Read Lines</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co">#file_list = './data/required_granules.txt'</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>file_list <span class="op">=</span> <span class="st">'./data/emit_search_results.txt'</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(file_list) <span class="im">as</span> f:</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    urls <span class="op">=</span> [line.rstrip(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>) <span class="cf">for</span> line <span class="kw">in</span> f]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Download the required granules.</p>
<div id="cell-96" class="cell" data-tags="[]" data-execution_count="51">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a directory to store the downloaded emit data</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>os.makedirs(<span class="st">'./data/emit_refl'</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get requests https session using Earthdata Login Info</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>fs <span class="op">=</span> earthaccess.get_requests_https_session()</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve granule asset ID from URL (to maintain existing naming convention)</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> url <span class="kw">in</span> urls:</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    granule_asset_id <span class="op">=</span> url.split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define Local Filepath</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    fp <span class="op">=</span> <span class="ss">f'./data/emit_refl/</span><span class="sc">{</span>granule_asset_id<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Download the Granule Asset if it doesn't exist</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.isfile(fp):</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> fs.get(url,stream<span class="op">=</span><span class="va">True</span>) <span class="im">as</span> src:</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(fp,<span class="st">'wb'</span>) <span class="im">as</span> dst:</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> chunk <span class="kw">in</span> src.iter_content(chunk_size<span class="op">=</span><span class="dv">64</span><span class="op">*</span><span class="dv">1024</span><span class="op">*</span><span class="dv">1024</span>):</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>                    dst.write(chunk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Congratulations, now you have downloaded co-located hyperspectral reflectance data from NEON airborne collections and the EMIT instrument on the ISS.</p>
</section>
<section id="contact-info" class="level2">
<h2 class="anchored" data-anchor-id="contact-info">Contact Info:</h2>
<p><strong>Land Processes Distributed Active Archive Center (LP DAAC)</strong><sup>1</sup></p>
<p>Email: LPDAAC@usgs.gov<br>
Voice: +1-866-573-3222<br>
Website: <a href="https://lpdaac.usgs.gov/" class="uri">https://lpdaac.usgs.gov/</a></p>
<p><sup>1</sup>Work performed under USGS contract G15PD00467 for NASA contract NNG14HH33I.</p>
<p><strong>National Ecological Observatory Network (NEON)</strong><sup>2</sup></p>
<p>Website: <a href="https://www.neonscience.org/" class="uri">https://www.neonscience.org/</a><br>
Contact: <a href="https://www.neonscience.org/about/contact-us" class="uri">https://www.neonscience.org/about/contact-us</a><br>
Date last modified: 08-27-2024</p>
<p><sup>2</sup>NEON is a project sponsored by the National Science Foundation and operated by Battelle.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/nasa\.github\.io\/VITALS\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>VSWIR Imaging and Thermal Applications, Learning, and Science.</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>